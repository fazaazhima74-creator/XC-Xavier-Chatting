<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Aplikasi Media Sosial Modern - Dark Mode</title>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;700&display=swap" rel="stylesheet">
    <style>
        /* CSS Utama */
        :root {
            /* Dark Mode Variables */
            --dark-bg: #1a1a2e;
            --dark-card: rgba(43, 43, 67, 0.7);
            --accent-purple: #927dfc;
            --text-light: #e0e0e0;
            --border-color: rgba(146, 125, 252, 0.3);

            /* Default Theme is Dark */
            --bg-color: var(--dark-bg);
            --card-color: var(--dark-card);
            --text-color: var(--text-light);
            --input-bg: rgba(0, 0, 0, 0.3);
        }

        /* Light Mode Overrides */
        .light-mode {
            --bg-color: #f0f0f5;
            --card-color: rgba(255, 255, 255, 0.9);
            --accent-purple: #5b3ce0;
            --text-color: #1a1a2e;
            --border-color: rgba(91, 60, 224, 0.2);
            --input-bg: rgba(255, 255, 255, 0.7);
        }

        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            font-family: 'Poppins', sans-serif;
        }

        body {
            background-color: var(--bg-color);
            color: var(--text-color);
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            transition: background-color 0.3s, color 0.3s;
            overflow-x: hidden;
        }

        /* --- HALAMAN AWAL BARU --- */
        .welcome-container {
            width: 90%;
            max-width: 500px;
            background: var(--card-color);
            border-radius: 20px;
            padding: 40px 30px;
            box-shadow: 0 15px 35px rgba(0, 0, 0, 0.3);
            -webkit-backdrop-filter: blur(15px);
            backdrop-filter: blur(15px);
            border: 1px solid var(--border-color);
            text-align: center;
        }

        .app-logo-large {
            font-size: 48px;
            font-weight: 700;
            color: var(--accent-purple);
            margin-bottom: 20px;
        }

        .app-slogan {
            font-size: 18px;
            margin-bottom: 40px;
            color: var(--text-color);
            opacity: 0.8;
        }

        .welcome-buttons {
            display: flex;
            flex-direction: column;
            gap: 20px;
            margin-top: 30px;
        }

        .welcome-btn {
            padding: 18px;
            border-radius: 12px;
            font-size: 18px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            border: none;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 12px;
        }

        .register-btn {
            background-color: var(--accent-purple);
            color: white;
        }

        .register-btn:hover {
            background-color: #7a68e0;
            transform: translateY(-3px);
            box-shadow: 0 10px 20px rgba(146, 125, 252, 0.3);
        }

        .login-btn {
            background-color: rgba(146, 125, 252, 0.2);
            color: var(--accent-purple);
            border: 2px solid var(--accent-purple);
        }

        .login-btn:hover {
            background-color: rgba(146, 125, 252, 0.3);
            transform: translateY(-3px);
            box-shadow: 0 10px 20px rgba(146, 125, 252, 0.2);
        }

        .btn-icon {
            font-size: 24px;
        }

        /* --- Tampilan Pendaftaran/Login/Setup --- */

        .auth-container {
            width: 90%;
            max-width: 400px;
            background: var(--card-color);
            border-radius: 15px;
            padding: 30px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
            -webkit-backdrop-filter: blur(10px);
            backdrop-filter: blur(10px);
            border: 1px solid var(--border-color);
        }

        .auth-container h2 {
            text-align: center;
            color: var(--accent-purple);
            margin-bottom: 20px;
            font-weight: 600;
        }

        .input-group {
            margin-bottom: 15px;
        }

        .input-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: 300;
        }

        .input-group input, .input-group button, .input-group textarea, .input-group select {
            width: 100%;
            padding: 12px;
            border: 1px solid var(--border-color);
            border-radius: 8px;
            background: var(--input-bg);
            color: var(--text-color);
            font-size: 16px;
            transition: border-color 0.3s, background-color 0.3s, color 0.3s;
        }

        .input-group input:focus, .input-group textarea:focus, .input-group select:focus {
            outline: none;
            border-color: var(--accent-purple);
        }

        .input-group button {
            background-color: var(--accent-purple);
            border: none;
            color: white;
            cursor: pointer;
            font-weight: 600;
            margin-top: 10px;
            transition: background-color 0.3s;
        }

        .input-group button:hover {
            background-color: #7a68e0;
        }

        .link-group {
            text-align: center;
            margin-top: 20px;
        }

        .link-group a {
            color: var(--accent-purple);
            text-decoration: none;
            font-size: 14px;
            transition: color 0.3s;
        }

        .link-group a:hover {
            color: var(--text-color);
        }
        
        /* Gaya Khusus Setup Profil */
        .profile-setup {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 20px;
        }
        
        .profile-placeholder {
            width: 100px;
            height: 100px;
            border-radius: 50%;
            background: rgba(146, 125, 252, 0.2);
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 14px;
            color: var(--accent-purple);
            border: 2px dashed var(--accent-purple);
            cursor: pointer;
            overflow: hidden;
            text-align: center;
            line-height: 1.2;
            padding: 5px;
        }
        
        .profile-placeholder img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        /* CSS Beranda lainnya */
        .home-container {
            display: grid;
            width: 100%;
            max-width: 1200px;
            min-height: 100vh;
            grid-template-columns: 250px 1fr 280px;
            grid-template-areas:
                "header header header"
                "sidebar-left main-content sidebar-right"
                "bottom-nav bottom-nav bottom-nav";
            gap: 20px;
            padding: 20px;
        }
        .sidebar-left { grid-area: sidebar-left; }
        .main-content { grid-area: main-content; }
        .sidebar-right { grid-area: sidebar-right; }
        .bottom-nav { grid-area: bottom-nav; }

        .sidebar-left, .main-content, .sidebar-right {
            padding: 20px;
            border-radius: 15px;
            background: var(--card-color);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
            -webkit-backdrop-filter: blur(5px);
            backdrop-filter: blur(5px);
            border: 1px solid var(--border-color);
        }
        
        .header {
            grid-area: header;
            background: rgba(26, 26, 46, 0.9);
            padding: 10px 30px;
            border-radius: 15px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            position: sticky;
            top: 20px;
            z-index: 10;
        }

        /* BARU: Gaya Info Profil di Header */
        .header-profile-info {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-right: auto;
            margin-left: 0;
            width: auto;
        }
        .header-profile-info .profile-pic {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            object-fit: cover;
            border: 2px solid var(--accent-purple);
            cursor: pointer;
        }
        .header-profile-info .username {
            font-weight: 600;
            font-size: 16px;
            color: var(--text-color);
        }
        .header-profile-info .app-logo {
            color: var(--accent-purple);
            font-size: 20px;
            font-weight: 700;
            margin-right: 20px;
        }

        /* PERUBAHAN: Profil di Sidebar - Horizontal */
        .user-profile {
            display: flex;
            align-items: center;
            text-align: left;
            margin-bottom: 30px;
            gap: 15px;
        }
        .profile-pic {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            object-fit: cover;
            border: 3px solid var(--accent-purple);
            flex-shrink: 0;
            cursor: pointer;
        }
        
        .profile-name-display {
            text-align: left;
            margin-top: 0;
        }
        .profile-name-display .name {
            font-size: 16px;
            font-weight: 600;
            color: var(--text-color);
            margin-bottom: 4px;
        }
        .profile-name-display .status {
            font-size: 12px;
            color: var(--accent-purple);
        }

        /* Light Mode Header */
        .light-mode .header {
            background: rgba(255, 255, 255, 0.9);
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        }
        
        .search-bar {
            flex-grow: 1;
            max-width: 600px;
            margin: 0 20px;
            position: relative;
        }
        .search-bar input {
            width: 100%;
            padding: 10px 15px;
            border: 1px solid var(--border-color);
            border-radius: 20px;
            background: var(--input-bg);
            color: var(--text-color);
            cursor: pointer;
        }
        .header .menu-wrapper {
            position: relative;
        }
        .header .menu-icon {
            color: var(--accent-purple);
            font-size: 24px;
            cursor: pointer;
        }

        /* Dropdown Menu (BARU) */
        .dropdown-menu {
            position: absolute;
            top: 100%;
            right: 0;
            width: 250px;
            background: var(--card-color);
            border-radius: 10px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
            border: 1px solid var(--border-color);
            padding: 10px 0;
            z-index: 20;
            opacity: 0;
            visibility: hidden;
            transform: translateY(10px);
            transition: opacity 0.3s, transform 0.3s, visibility 0.3s;
        }
        .menu-wrapper:hover .dropdown-menu,
        .dropdown-menu.active {
            opacity: 1;
            visibility: visible;
            transform: translateY(0);
        }

        .dropdown-menu-item {
            padding: 12px 20px;
            cursor: pointer;
            transition: background-color 0.2s;
            display: flex;
            flex-direction: column;
        }
        .dropdown-menu-item:hover {
            background: rgba(146, 125, 252, 0.15);
        }
        .dropdown-menu-item p {
            font-size: 12px;
            color: #a0a0a0;
        }
        
        /* Toggle Switch (BARU) */
        .theme-toggle-container {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px 20px;
            border-top: 1px solid var(--border-color);
            margin-top: 5px;
        }
        .switch {
          position: relative;
          display: inline-block;
          width: 40px;
          height: 24px;
        }
        .switch input {
          opacity: 0;
          width: 0;
          height: 0;
        }
        .slider {
          position: absolute;
          cursor: pointer;
          top: 0;
          left: 0;
          right: 0;
          bottom: 0;
          background-color: #ccc;
          transition: .4s;
          border-radius: 24px;
        }
        .slider:before {
          position: absolute;
          content: "";
          height: 16px;
          width: 16px;
          left: 4px;
          bottom: 4px;
          background-color: white;
          transition: .4s;
          border-radius: 50%;
        }
        input:checked + .slider {
          background-color: var(--accent-purple);
        }
        input:checked + .slider:before {
          transform: translateX(16px);
        }

        /* PERUBAHAN: Gaya untuk Fitur Tambah Teman - DIPERBAIKI */
        .add-friend-section {
            margin-top: 20px;
        }
        
        .add-friend-btn {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            width: 100%;
            padding: 12px;
            background: rgba(146, 125, 252, 0.2);
            border: 2px dashed var(--accent-purple);
            border-radius: 10px;
            color: var(--accent-purple);
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            margin-bottom: 15px;
        }
        
        .add-friend-btn:hover {
            background: rgba(146, 125, 252, 0.3);
            transform: translateY(-2px);
        }
        
        .add-friend-btn .icon {
            font-size: 20px;
            font-weight: bold;
        }
        
        .search-friend-container {
            display: none;
            margin-top: 15px;
        }
        
        .search-friend-input {
            width: 100%;
            padding: 10px 15px;
            border: 1px solid var(--border-color);
            border-radius: 20px;
            background: var(--input-bg);
            color: var(--text-color);
            margin-bottom: 15px;
        }
        
        .search-results {
            max-height: 200px;
            overflow-y: auto;
        }
        
        .friend-result-item {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 10px;
            border-radius: 8px;
            margin-bottom: 8px;
            background: rgba(255, 255, 255, 0.05);
            transition: background-color 0.2s;
        }
        
        .friend-result-item:hover {
            background: rgba(146, 125, 252, 0.1);
        }
        
        .friend-info {
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .friend-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            object-fit: cover;
            border: 2px solid var(--accent-purple);
        }
        
        .friend-details {
            display: flex;
            flex-direction: column;
        }
        
        .friend-name {
            font-weight: 600;
            font-size: 14px;
        }
        
        .friend-username {
            font-size: 12px;
            color: #a0a0a0;
        }
        
        .add-friend-icon {
            width: 30px;
            height: 30px;
            border-radius: 50%;
            background: var(--accent-purple);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            cursor: pointer;
            transition: background-color 0.3s;
        }
        
        .add-friend-icon:hover {
            background: #7a68e0;
        }
        
        /* PERUBAHAN: Daftar Teman yang Sudah Ditambahkan - DIPERBAIKI */
        .friends-list {
            margin-top: 20px;
        }
        
        .friends-list-title {
            font-size: 16px;
            font-weight: 600;
            margin-bottom: 15px;
            color: var(--text-color);
            padding-bottom: 10px;
            border-bottom: 1px solid var(--border-color);
        }
        
        .friend-item {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 10px;
            border-radius: 10px;
            margin-bottom: 10px;
            background: rgba(255, 255, 255, 0.05);
            transition: all 0.3s;
            cursor: pointer;
            border: 1px solid transparent;
        }
        
        .friend-item:hover {
            background: rgba(146, 125, 252, 0.1);
            border-color: var(--border-color);
            transform: translateX(5px);
        }
        
        .friend-item .friend-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            object-fit: cover;
            border: 2px solid var(--accent-purple);
        }
        
        .friend-item .friend-details {
            flex: 1;
        }
        
        .friend-item .friend-name {
            font-weight: 600;
            font-size: 14px;
            color: var(--text-color);
        }
        
        .friend-item .friend-status {
            font-size: 12px;
            color: #a0a0a0;
            display: flex;
            align-items: center;
            gap: 5px;
        }
        
        .status-indicator {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            display: inline-block;
        }
        
        .status-online {
            background-color: #4CAF50;
        }
        
        .status-offline {
            background-color: #ccc;
        }

        /* PERUBAHAN: Halaman Profil dan Setting */
        .profile-page, .settings-page {
            width: 90%;
            max-width: 500px;
            background: var(--card-color);
            border-radius: 15px;
            padding: 30px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
            -webkit-backdrop-filter: blur(10px);
            backdrop-filter: blur(10px);
            border: 1px solid var(--border-color);
        }

        .page-header {
            display: flex;
            align-items: center;
            margin-bottom: 30px;
            gap: 15px;
        }

        .back-btn {
            background: none;
            border: none;
            color: var(--accent-purple);
            font-size: 24px;
            cursor: pointer;
            padding: 5px;
        }

        .page-title {
            font-size: 24px;
            font-weight: 600;
            color: var(--accent-purple);
        }

        .profile-display {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 20px;
            margin-bottom: 30px;
        }

        .profile-display .profile-pic {
            width: 120px;
            height: 120px;
        }

        .info-group {
            margin-bottom: 20px;
            padding: 15px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 10px;
        }

        .info-label {
            font-size: 12px;
            color: #a0a0a0;
            margin-bottom: 5px;
        }

        .info-value {
            font-size: 16px;
            font-weight: 500;
        }

        .sensitive-info {
            color: #a0a0a0;
            letter-spacing: 2px;
        }

        .settings-option {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 10px;
            margin-bottom: 15px;
            cursor: pointer;
            transition: background-color 0.2s;
        }

        .settings-option:hover {
            background: rgba(146, 125, 252, 0.1);
        }

        .option-info {
            display: flex;
            flex-direction: column;
        }

        .option-title {
            font-weight: 600;
            margin-bottom: 5px;
        }

        .option-desc {
            font-size: 12px;
            color: #a0a0a0;
        }

        /* PERUBAHAN: Gaya untuk sub-menu setting */
        .sub-menu {
            display: none;
            margin-top: 10px;
            padding: 15px;
            background: rgba(255, 255, 255, 0.03);
            border-radius: 8px;
            border: 1px solid var(--border-color);
        }

        .sub-menu.active {
            display: block;
        }

        .notification-option, .privacy-option {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
            padding: 10px;
            border-radius: 6px;
            transition: background-color 0.2s;
        }

        .notification-option:hover, .privacy-option:hover {
            background: rgba(146, 125, 252, 0.1);
        }

        .language-select {
            width: 100%;
            padding: 10px;
            border: 1px solid var(--border-color);
            border-radius: 8px;
            background: var(--input-bg);
            color: var(--text-color);
            margin-top: 10px;
        }

        /* PERUBAHAN: Area untuk postingan yang akan ditampilkan - DIHAPUS */
        .no-posts-message {
            text-align: center;
            padding: 40px 20px;
            color: #a0a0a0;
        }

        /* PERUBAHAN: Navigasi Bawah */
        .bottom-nav {
            display: flex;
            justify-content: space-around;
            align-items: center;
            background: var(--card-color);
            border-radius: 15px;
            padding: 15px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
            -webkit-backdrop-filter: blur(5px);
            backdrop-filter: blur(5px);
            border: 1px solid var(--border-color);
            position: sticky;
            bottom: 20px;
            z-index: 10;
        }

        .nav-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 5px;
            cursor: pointer;
            transition: all 0.3s;
            padding: 10px 20px;
            border-radius: 10px;
            flex: 1;
            text-align: center;
        }

        .nav-item:hover {
            background: rgba(146, 125, 252, 0.1);
        }

        .nav-item.active {
            background: rgba(146, 125, 252, 0.2);
            color: var(--accent-purple);
        }

        .nav-icon {
            font-size: 24px;
        }

        .nav-label {
            font-size: 12px;
            font-weight: 600;
        }

        /* PERUBAHAN: Halaman Pesan/Notifikasi - DIPISAHKAN HANYA UNTUK OPERATOR */
        .messages-page {
            width: 100%;
            height: 100vh;
            background: var(--bg-color);
            position: fixed;
            top: 0;
            left: 0;
            z-index: 100;
            display: flex;
            flex-direction: column;
        }

        .messages-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 20px;
            background: var(--card-color);
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
            z-index: 10;
        }

        .messages-content {
            flex: 1;
            overflow-y: auto;
            padding: 15px;
        }

        .message-list {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .message-item {
            display: flex;
            align-items: center;
            gap: 15px;
            padding: 15px;
            background: var(--card-color);
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.3s;
            border: 1px solid var(--border-color);
        }

        .message-item:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
            background: rgba(146, 125, 252, 0.1);
        }

        .message-item.unread {
            border-left: 4px solid var(--accent-purple);
        }

        .message-avatar {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            object-fit: cover;
            border: 2px solid var(--accent-purple);
        }

        .message-info {
            flex: 1;
            min-width: 0;
        }

        .message-sender {
            font-weight: 600;
            font-size: 16px;
            margin-bottom: 5px;
            color: var(--text-color);
        }

        .message-preview {
            font-size: 14px;
            color: #a0a0a0;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .message-time {
            font-size: 12px;
            color: #a0a0a0;
            text-align: right;
            margin-top: 5px;
        }

        .message-badge {
            background: var(--accent-purple);
            color: white;
            width: 20px;
            height: 20px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 12px;
            font-weight: 600;
        }

        /* Halaman Chat yang sudah ada - tetap pertahankan */
        .chat-page {
            width: 100%;
            height: 100vh;
            background: var(--bg-color);
            position: fixed;
            top: 0;
            left: 0;
            z-index: 100;
            display: flex;
            flex-direction: column;
        }

        .chat-header {
            display: flex;
            align-items: center;
            padding: 15px 20px;
            background: var(--card-color);
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
            z-index: 10;
            gap: 15px;
        }

        .chat-header .profile-pic {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            object-fit: cover;
            border: 2px solid var(--accent-purple);
        }

        .chat-info {
            flex: 1;
        }

        .chat-name {
            font-weight: 600;
            font-size: 16px;
        }

        .chat-status {
            font-size: 12px;
            color: #a0a0a0;
        }

        .chat-actions {
            display: flex;
            gap: 15px;
        }

        .chat-action-btn {
            background: none;
            border: none;
            color: var(--accent-purple);
            font-size: 20px;
            cursor: pointer;
        }

        .chat-content {
            flex: 1;
            padding: 20px;
            overflow-y: auto;
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .message {
            max-width: 70%;
            padding: 12px 15px;
            border-radius: 15px;
            position: relative;
            word-wrap: break-word;
        }

        .message.sent {
            align-self: flex-end;
            background: var(--accent-purple);
            color: white;
            border-bottom-right-radius: 5px;
        }

        .message.received {
            align-self: flex-start;
            background: var(--card-color);
            border: 1px solid var(--border-color);
            border-bottom-left-radius: 5px;
        }

        .message-time {
            font-size: 10px;
            text-align: right;
            margin-top: 5px;
            opacity: 0.7;
        }

        .message-media {
            max-width: 100%;
            border-radius: 10px;
            margin-top: 5px;
        }

        .message-media img, .message-media video {
            max-width: 100%;
            border-radius: 10px;
        }

        .chat-input-container {
            display: flex;
            padding: 15px 20px;
            background: var(--card-color);
            border-top: 1px solid var(--border-color);
            gap: 10px;
            align-items: flex-end;
        }

        .chat-input {
            flex: 1;
            padding: 12px 15px;
            border: 1px solid var(--border-color);
            border-radius: 20px;
            background: var(--input-bg);
            color: var(--text-color);
            resize: none;
            max-height: 120px;
            font-size: 14px;
        }

        .chat-input:focus {
            outline: none;
            border-color: var(--accent-purple);
        }

        .chat-attach-btn {
            background: none;
            border: none;
            color: var(--accent-purple);
            font-size: 24px;
            cursor: pointer;
            padding: 8px;
        }

        .chat-send-btn {
            background: var(--accent-purple);
            border: none;
            color: white;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            font-size: 18px;
        }

        .chat-send-btn:hover {
            background: #7a68e0;
        }

        /* PERUBAHAN: Gaya untuk judul beranda di main content */
        .home-title-main {
            font-size: 24px;
            font-weight: 700;
            color: var(--accent-purple);
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 2px solid var(--border-color);
        }

        /* BARU: Halaman Upload Konten - SEPERTI TIKTOK */
        .upload-page {
            width: 100%;
            height: 100vh;
            background: #000;
            position: fixed;
            top: 0;
            left: 0;
            z-index: 1000;
            display: none;
            flex-direction: column;
        }

        .upload-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 20px;
            background: rgba(0, 0, 0, 0.7);
            z-index: 10;
            position: absolute;
            width: 100%;
            top: 0;
            left: 0;
        }

        .upload-header .back-btn {
            color: white;
            font-size: 28px;
        }

        .upload-header .page-title {
            color: white;
            font-size: 20px;
        }

        .upload-content {
            flex: 1;
            display: flex;
            flex-direction: column;
            position: relative;
            overflow: hidden;
        }

        /* Mode Selector - FOTO/VIDIO */
        .mode-selector {
            display: flex;
            justify-content: center;
            gap: 40px;
            padding: 20px;
            background: rgba(0, 0, 0, 0.5);
            position: absolute;
            top: 70px;
            width: 100%;
            z-index: 5;
        }

        .mode-btn {
            background: none;
            border: none;
            color: rgba(255, 255, 255, 0.7);
            font-size: 20px;
            font-weight: 600;
            cursor: pointer;
            padding: 10px 20px;
            transition: all 0.3s;
            position: relative;
        }

        .mode-btn.active {
            color: white;
        }

        .mode-btn.active::after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 50%;
            transform: translateX(-50%);
            width: 30px;
            height: 3px;
            background: var(--accent-purple);
            border-radius: 2px;
        }

        /* Camera Preview */
        .camera-container {
            flex: 1;
            position: relative;
            overflow: hidden;
            background: #000;
        }

        .camera-preview {
            width: 100%;
            height: 100%;
            object-fit: cover;
            transform: scaleX(-1); /* Mirror effect */
        }

        /* Camera Controls */
        .camera-controls {
            position: absolute;
            bottom: 30px;
            left: 0;
            width: 100%;
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 50px;
            padding: 0 20px;
            z-index: 10;
        }

        .shutter-btn {
            width: 70px;
            height: 70px;
            border-radius: 50%;
            background: white;
            border: 5px solid rgba(255, 255, 255, 0.3);
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s;
        }

        .shutter-btn:hover {
            transform: scale(1.05);
        }

        .shutter-btn.recording {
            background: #ff4757;
            animation: pulse 1.5s infinite;
        }

        @keyframes pulse {
            0% { box-shadow: 0 0 0 0 rgba(255, 71, 87, 0.7); }
            70% { box-shadow: 0 0 0 15px rgba(255, 71, 87, 0); }
            100% { box-shadow: 0 0 0 0 rgba(255, 71, 87, 0); }
        }

        .shutter-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .gallery-btn {
            position: absolute;
            right: 30px;
            bottom: 40px;
            background: rgba(0, 0, 0, 0.5);
            border: 2px solid white;
            width: 50px;
            height: 50px;
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            z-index: 10;
        }

        .gallery-btn img {
            width: 30px;
            height: 30px;
            border-radius: 5px;
            object-fit: cover;
        }

        .flip-camera-btn {
            position: absolute;
            left: 30px;
            bottom: 40px;
            background: rgba(0, 0, 0, 0.5);
            border: 2px solid white;
            width: 50px;
            height: 50px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            z-index: 10;
            color: white;
            font-size: 24px;
        }

        /* Recording Timer */
        .recording-timer {
            position: absolute;
            top: 120px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(255, 71, 87, 0.8);
            color: white;
            padding: 8px 16px;
            border-radius: 20px;
            font-size: 16px;
            font-weight: 600;
            z-index: 10;
            display: none;
        }

        /* Preview After Capture */
        .capture-preview {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: #000;
            z-index: 20;
            display: none;
            flex-direction: column;
        }

        .preview-media-container {
            flex: 1;
            display: flex;
            align-items: center;
            justify-content: center;
            overflow: hidden;
        }

        .preview-media {
            max-width: 100%;
            max-height: 70vh;
            object-fit: contain;
        }

        .preview-controls {
            padding: 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            background: rgba(0, 0, 0, 0.8);
        }

        .preview-btn {
            padding: 12px 30px;
            border-radius: 25px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            border: none;
            transition: all 0.3s;
        }

        .retake-btn {
            background: rgba(255, 255, 255, 0.1);
            color: white;
            border: 2px solid white;
        }

        .upload-btn {
            background: var(--accent-purple);
            color: white;
        }

        .upload-btn:hover {
            background: #7a68e0;
        }

        /* Upload Form */
        .upload-form {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: var(--bg-color);
            z-index: 30;
            display: none;
            flex-direction: column;
        }

        .form-header {
            padding: 20px;
            background: var(--card-color);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .form-content {
            flex: 1;
            padding: 20px;
            overflow-y: auto;
        }

        .form-preview {
            width: 100%;
            max-height: 300px;
            border-radius: 10px;
            overflow: hidden;
            margin-bottom: 20px;
        }

        .form-preview img, .form-preview video {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .caption-input {
            width: 100%;
            min-height: 100px;
            padding: 15px;
            border: 1px solid var(--border-color);
            border-radius: 10px;
            background: var(--input-bg);
            color: var(--text-color);
            font-size: 16px;
            resize: vertical;
            margin-bottom: 20px;
        }

        .caption-input:focus {
            outline: none;
            border-color: var(--accent-purple);
        }

        .upload-options {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .option-toggle {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 10px;
        }

        .option-label {
            display: flex;
            flex-direction: column;
        }

        .option-name {
            font-weight: 600;
            margin-bottom: 5px;
        }

        .option-desc {
            font-size: 12px;
            color: #a0a0a0;
        }

        .form-actions {
            padding: 20px;
            background: var(--card-color);
            display: flex;
            gap: 10px;
        }

        .cancel-btn {
            flex: 1;
            padding: 15px;
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid var(--border-color);
            border-radius: 10px;
            color: var(--text-color);
            font-weight: 600;
            cursor: pointer;
        }

        .post-btn {
            flex: 2;
            padding: 15px;
            background: var(--accent-purple);
            border: none;
            border-radius: 10px;
            color: white;
            font-weight: 600;
            cursor: pointer;
        }

        .post-btn:hover {
            background: #7a68e0;
        }

        /* BARU: Gaya untuk postingan di beranda */
        .post {
            background: var(--card-color);
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
            border: 1px solid var(--border-color);
        }

        .post-header {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 15px;
        }

        .post-user-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            object-fit: cover;
            border: 2px solid var(--accent-purple);
            cursor: pointer;
        }

        .post-user-info {
            display: flex;
            flex-direction: column;
        }

        .post-username {
            font-weight: 600;
            font-size: 16px;
            cursor: pointer;
        }

        .post-time {
            font-size: 12px;
            color: #a0a0a0;
        }

        .post-content {
            margin-bottom: 15px;
        }

        .post-text {
            margin-bottom: 10px;
            line-height: 1.5;
        }

        .post-media {
            width: 100%;
            border-radius: 10px;
            overflow: hidden;
            margin-bottom: 10px;
            cursor: pointer;
        }

        .post-media img, .post-media video {
            width: 100%;
            max-height: 500px;
            object-fit: contain;
        }

        .post-stats {
            display: flex;
            justify-content: space-between;
            margin-bottom: 10px;
            font-size: 14px;
            color: #a0a0a0;
        }

        .post-actions {
            display: flex;
            justify-content: space-around;
            border-top: 1px solid var(--border-color);
            padding-top: 15px;
        }

        .post-action {
            display: flex;
            align-items: center;
            gap: 5px;
            cursor: pointer;
            transition: color 0.3s;
            padding: 5px 10px;
            border-radius: 8px;
        }

        .post-action:hover {
            background: rgba(146, 125, 252, 0.1);
            color: var(--accent-purple);
        }

        .post-action.active {
            color: var(--accent-purple);
        }

        .post-action-icon {
            font-size: 20px;
        }

        .post-action-count {
            font-size: 14px;
            font-weight: 600;
        }

        .comments-section {
            margin-top: 15px;
            padding-top: 15px;
            border-top: 1px solid var(--border-color);
        }

        .comment-input {
            display: flex;
            gap: 10px;
            margin-bottom: 15px;
        }

        .comment-input input {
            flex: 1;
            padding: 10px 15px;
            border: 1px solid var(--border-color);
            border-radius: 20px;
            background: var(--input-bg);
            color: var(--text-color);
        }

        .comment-btn {
            padding: 10px 15px;
            background: var(--accent-purple);
            border: none;
            border-radius: 20px;
            color: white;
            font-weight: 600;
            cursor: pointer;
        }

        .comment {
            display: flex;
            gap: 10px;
            margin-bottom: 15px;
        }

        .comment-avatar {
            width: 30px;
            height: 30px;
            border-radius: 50%;
            object-fit: cover;
        }

        .comment-content {
            flex: 1;
        }

        .comment-user {
            font-weight: 600;
            font-size: 14px;
            margin-bottom: 5px;
        }

        .comment-text {
            font-size: 14px;
            line-height: 1.4;
        }

        .comment-actions {
            display: flex;
            gap: 10px;
            margin-top: 5px;
            font-size: 12px;
            color: #a0a0a0;
        }

        .comment-action {
            cursor: pointer;
        }

        .comment-action:hover {
            color: var(--accent-purple);
        }

        /* BARU: Halaman Profil Pengguna */
        .user-profile-page {
            width: 100%;
            max-width: 600px;
            background: var(--card-color);
            border-radius: 15px;
            padding: 30px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
            -webkit-backdrop-filter: blur(10px);
            backdrop-filter: blur(10px);
            border: 1px solid var(--border-color);
        }

        .profile-header {
            display: flex;
            align-items: center;
            gap: 20px;
            margin-bottom: 30px;
        }

        .profile-header .profile-pic {
            width: 100px;
            height: 100px;
            border-radius: 50%;
            object-fit: cover;
            border: 3px solid var(--accent-purple);
        }

        .profile-info {
            flex: 1;
        }

        .profile-name {
            font-size: 24px;
            font-weight: 700;
            margin-bottom: 5px;
        }

        .profile-username {
            font-size: 16px;
            color: #a0a0a0;
            margin-bottom: 15px;
        }

        .profile-stats {
            display: flex;
            gap: 20px;
            margin-bottom: 20px;
        }

        .stat-item {
            text-align: center;
        }

        .stat-count {
            font-size: 18px;
            font-weight: 700;
        }

        .stat-label {
            font-size: 12px;
            color: #a0a0a0;
        }

        .profile-actions {
            display: flex;
            gap: 10px;
            margin-bottom: 30px;
        }

        .action-button {
            flex: 1;
            padding: 12px;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            text-align: center;
        }

        .follow-button {
            background: var(--accent-purple);
            color: white;
            border: none;
        }

        .follow-button:hover {
            background: #7a68e0;
        }

        .message-button {
            background: rgba(146, 125, 252, 0.2);
            color: var(--accent-purple);
            border: 1px solid var(--accent-purple);
        }

        .message-button:hover {
            background: rgba(146, 125, 252, 0.3);
        }

        .profile-tabs {
            display: flex;
            border-bottom: 1px solid var(--border-color);
            margin-bottom: 20px;
        }

        .profile-tab {
            padding: 10px 20px;
            cursor: pointer;
            transition: all 0.3s;
            border-bottom: 2px solid transparent;
        }

        .profile-tab.active {
            border-bottom: 2px solid var(--accent-purple);
            color: var(--accent-purple);
            font-weight: 600;
        }

        .profile-tab:hover {
            background: rgba(146, 125, 252, 0.1);
        }

        .profile-posts {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 10px;
        }

        .profile-post {
            aspect-ratio: 1;
            border-radius: 10px;
            overflow: hidden;
            background: rgba(255, 255, 255, 0.05);
            cursor: pointer;
            position: relative;
        }

        .profile-post img, .profile-post video {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .profile-post-text {
            padding: 15px;
            font-size: 14px;
            line-height: 1.4;
            display: flex;
            align-items: center;
            justify-content: center;
            text-align: center;
        }

        .no-posts {
            grid-column: 1 / -1;
            text-align: center;
            padding: 40px 20px;
            color: #a0a0a0;
        }

        /* BARU: Halaman Pencarian */
        .search-page {
            width: 100%;
            height: 100vh;
            background: var(--bg-color);
            position: fixed;
            top: 0;
            left: 0;
            z-index: 100;
            display: flex;
            flex-direction: column;
        }

        .search-header {
            display: flex;
            align-items: center;
            padding: 15px 20px;
            background: var(--card-color);
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
            z-index: 10;
            gap: 15px;
        }

        .search-input-container {
            flex: 1;
            display: flex;
            align-items: center;
            background: var(--input-bg);
            border-radius: 20px;
            padding: 8px 15px;
            border: 1px solid var(--border-color);
        }

        .search-input {
            flex: 1;
            background: transparent;
            border: none;
            color: var(--text-color);
            font-size: 16px;
            padding: 8px;
        }

        .search-input:focus {
            outline: none;
        }

        .search-clear {
            background: none;
            border: none;
            color: var(--accent-purple);
            font-size: 20px;
            cursor: pointer;
            padding: 5px;
        }

        /* BARU: Halaman Error Koneksi */
        .error-container {
            width: 90%;
            max-width: 500px;
            background: var(--card-color);
            border-radius: 20px;
            padding: 40px 30px;
            box-shadow: 0 15px 35px rgba(0, 0, 0, 0.3);
            -webkit-backdrop-filter: blur(15px);
            backdrop-filter: blur(15px);
            border: 1px solid var(--border-color);
            text-align: center;
        }

        .error-icon {
            font-size: 80px;
            margin-bottom: 20px;
            color: #ff6b6b;
        }

        .error-title {
            font-size: 28px;
            font-weight: 700;
            color: var(--accent-purple);
            margin-bottom: 15px;
        }

        .error-message {
            font-size: 16px;
            margin-bottom: 30px;
            color: var(--text-color);
            opacity: 0.8;
        }

        .reload-btn {
            padding: 15px 30px;
            background-color: var(--accent-purple);
            color: white;
            border: none;
            border-radius: 12px;
            font-size: 18px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            margin-bottom: 15px;
        }

        .reload-btn:hover {
            background-color: #7a68e0;
            transform: translateY(-3px);
            box-shadow: 0 10px 20px rgba(146, 125, 252, 0.3);
        }

        .connection-status {
            font-size: 14px;
            color: #ff6b6b;
            font-weight: 600;
        }

        /* PERUBAHAN: Halaman Chat dengan Teman */
        .friend-chat-page {
            width: 100%;
            height: 100vh;
            background: var(--bg-color);
            position: fixed;
            top: 0;
            left: 0;
            z-index: 100;
            display: flex;
            flex-direction: column;
        }

        .friend-chat-header {
            display: flex;
            align-items: center;
            padding: 15px 20px;
            background: var(--card-color);
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
            z-index: 10;
            gap: 15px;
        }

        .friend-chat-content {
            flex: 1;
            padding: 20px;
            overflow-y: auto;
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .friend-chat-input-container {
            display: flex;
            padding: 15px 20px;
            background: var(--card-color);
            border-top: 1px solid var(--border-color);
            gap: 10px;
            align-items: flex-end;
        }

        /* BARU: Chat Bubble untuk teman */
        .friend-message {
            max-width: 70%;
            padding: 12px 15px;
            border-radius: 15px;
            position: relative;
            word-wrap: break-word;
        }

        .friend-message.sent {
            align-self: flex-end;
            background: var(--accent-purple);
            color: white;
            border-bottom-right-radius: 5px;
        }

        .friend-message.received {
            align-self: flex-start;
            background: var(--card-color);
            border: 1px solid var(--border-color);
            border-bottom-left-radius: 5px;
        }

        .friend-message-time {
            font-size: 10px;
            text-align: right;
            margin-top: 5px;
            opacity: 0.7;
        }

        /* BARU: Style untuk message box */
        .message-box-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 1000;
            backdrop-filter: blur(5px);
        }

        .message-box-content {
            background: var(--card-color);
            border-radius: 15px;
            padding: 30px;
            max-width: 400px;
            width: 90%;
            box-shadow: 0 15px 35px rgba(0, 0, 0, 0.3);
            border: 2px solid var(--accent-purple);
            text-align: center;
        }

        .message-box-title {
            color: var(--accent-purple);
            font-size: 20px;
            font-weight: 600;
            margin-bottom: 15px;
        }

        .message-box-buttons {
            display: flex;
            gap: 10px;
            justify-content: center;
            margin-top: 20px;
        }

        .message-box-btn-primary {
            padding: 10px 20px;
            background: var(--accent-purple);
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s;
        }

        .message-box-btn-primary:hover {
            background: #7a68e0;
            transform: translateY(-2px);
        }

        .message-box-btn-secondary {
            padding: 10px 20px;
            background: rgba(146, 125, 252, 0.2);
            color: var(--accent-purple);
            border: 1px solid var(--accent-purple);
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s;
        }

        .message-box-btn-secondary:hover {
            background: rgba(146, 125, 252, 0.3);
            transform: translateY(-2px);
        }

        /* Media Query Responsif */
        @media (max-width: 900px) {
            .home-container {
                grid-template-columns: 1fr;
                grid-template-areas:
                    "header"
                    "sidebar-left"
                    "main-content"
                    "sidebar-right"
                    "bottom-nav";
            }
            .sidebar-left, .sidebar-right {
                display: block;
            }
            .header {
                position: static;
            }
            .search-bar {
                margin: 0 10px;
            }
            .dropdown-menu {
                right: 10px;
            }
            .header-profile-info .username {
                display: none;
            }
            .header-profile-info .app-logo {
                display: none;
            }
            .header-profile-info {
                 margin-right: 10px;
            }
            
            /* Responsif untuk profil horizontal */
            .user-profile {
                flex-direction: column;
                text-align: center;
                gap: 10px;
            }
            .profile-name-display {
                text-align: center;
            }
            
            /* Responsif untuk navigasi bawah */
            .bottom-nav {
                padding: 10px;
            }
            .nav-item {
                padding: 8px 12px;
            }
            .nav-icon {
                font-size: 20px;
            }
            .nav-label {
                font-size: 10px;
            }

            /* Responsif untuk halaman pesan */
            .message-item {
                padding: 12px;
            }
            .message-avatar {
                width: 40px;
                height: 40px;
            }

            /* Responsif untuk upload page */
            .camera-controls {
                gap: 30px;
            }

            .shutter-btn {
                width: 60px;
                height: 60px;
            }

            .gallery-btn {
                right: 20px;
                bottom: 30px;
                width: 45px;
                height: 45px;
            }

            .flip-camera-btn {
                left: 20px;
                bottom: 30px;
                width: 45px;
                height: 45px;
            }
        }
    </style>
</head>
<body>

    <!-- HALAMAN AWAL BARU -->
    <div class="welcome-container" id="welcome-screen">
        <div class="app-logo-large">XC Xavier</div>
        <div class="app-slogan">Temukan dan bagikan momen terbaik Anda</div>
        
        <div class="welcome-buttons">
            <button class="welcome-btn register-btn" onclick="showRegister()">
                <span class="btn-icon"></span>
                <span>Daftar</span>
            </button>
            <button class="welcome-btn login-btn" onclick="showLogin()">
                <span class="btn-icon"></span>
                <span>Login</span>
            </button>
        </div>
    </div>

    <!-- BARU: Halaman Error Koneksi -->
    <div class="error-container" id="error-screen" style="display:none;">
        <div class="error-icon"></div>
        <div class="error-title">Koneksi Terputus</div>
        <div class="error-message">Tidak dapat terhubung ke internet. Periksa koneksi Anda dan coba lagi.</div>
        <button class="reload-btn" onclick="checkConnection()">
            <span class="btn-icon"></span>
            <span>Muat Ulang</span>
        </button>
        <div class="connection-status" id="connection-status">NON KONEKSI</div>
    </div>

    <div class="auth-container" id="auth-screen" style="display:none;">
        <h2>Daftar Akun Baru</h2>
        
        <form id="register-form">
            <div class="input-group">
                <label for="reg_email">Email</label>
                <input type="email" id="reg_email" placeholder="contoh@email.com" required>
            </div>
            
            <div class="input-group">
                <label for="reg_password">Kata Sandi</label>
                <input type="password" id="reg_password" placeholder="Minimal 8 karakter" required>
            </div>
            
            <div class="input-group">
                <button type="submit">DAFTAR</button>
            </div>
        </form>

        <div class="link-group">
            <a href="#" onclick="showLogin()">Sudah punya akun? **LOGIN**</a>
            <span style="color:var(--text-color);"> | </span>
            <a href="#" onclick="showForgotPassword()">**Lupa Kata Sandi?**</a>
        </div>
    </div>
    
    <div class="auth-container" id="login-screen" style="display:none;">
        <h2>Login Akun</h2>
        <form id="login-form">
            <div class="input-group">
                <label for="log_email">Email</label>
                <input type="email" id="log_email" placeholder="Email Anda" required>
            </div>
            <div class="input-group">
                <label for="log_password">Kata Sandi</label>
                <input type="password" id="log_password" placeholder="Kata Sandi Anda" required>
            </div>
            <div class="input-group">
                <button type="submit">LOGIN</button>
            </div>
        </form>
        <div class="link-group">
            <a href="#" onclick="showRegister()">Belum punya akun? **DAFTAR**</a>
            <span style="color:var(--text-color);"> | </span>
            <a href="#" onclick="showForgotPassword()">**Lupa Kata Sandi?**</a>
        </div>
    </div>
    
    <div class="auth-container" id="forgot-screen" style="display:none;">
        <h2>Lupa Kata Sandi</h2>
        <p style="text-align: center; margin-bottom: 20px; font-size: 14px;">Masukkan email Anda, kami akan mengirimkan tautan reset.</p>
        <form id="forgot-form">
            <div class="input-group">
                <label for="forgot_email">Email</label>
                <input type="email" id="forgot_email" placeholder="Email terdaftar Anda" required>
            </div>
            <div class="input-group">
                <button type="submit">KIRIM TAUTAN RESET</button>
            </div>
        </form>
        <div class="link-group">
            <a href="#" onclick="showLogin()">**Kembali ke Login**</a>
        </div>
    </div>

    <div class="auth-container" id="profile-setup-screen" style="display:none;">
        <h2>Selesaikan Profil Anda </h2>
        <form id="profile-setup-form">
            <div class="profile-setup">
                <div class="profile-placeholder" onclick="document.getElementById('file_upload_input').click()">
                    <img id="preview-profile-pic" src="" alt="Foto Profil" style="display:none;">
                    <span id="placeholder-text">Klik untuk Upload Foto (WAJIB)</span>
                </div>
                <p id="upload-warning" style="color: #ff6b6b; font-size: 14px; display: none;">**Wajib** unggah foto profil.</p>
            </div>
            
            <input type="file" id="file_upload_input" accept="image/*" style="display:none;">
            
            <div class="input-group" style="margin-top: 20px;">
                <label for="profile_name">Nama Profil</label>
                <input type="text" id="profile_name" placeholder="Nama yang akan ditampilkan (Wajib)" required>
            </div>
            
            <div class="input-group">
                <button type="submit">LANJUT KE BERANDA</button>
            </div>
        </form>
    </div>
    
    <div class="home-container" id="home-screen" style="display:none;">
        
        <header class="header">
            <div class="header-profile-info">
                <div class="app-logo">XC</div>
                <img src="https://via.placeholder.com/80/927dfc/ffffff?text=U" alt="Foto Profil Pengguna" id="user-profile-pic-header" class="profile-pic" onclick="showUserProfilePage()">
                <span class="username" id="user-profile-name-header">**Nama Pengguna Anda**</span>
            </div>
            
            <div class="search-bar">
                <input type="text" id="main-search-input" placeholder="Cari Video, Akun, Topik, atau Lainnya..." oninput="handleSearchInput(event)" onfocus="showSearchSuggestions()">
                <div class="search-suggestions" id="search-suggestions">
                    <!-- Saran pencarian akan ditampilkan di sini -->
                </div>
            </div>
            
            <div class="menu-wrapper">
                <div class="menu-icon">
                    <span style="font-size: 24px;">&#9776;</span>
                </div>
                
                <div class="dropdown-menu">
                    <div class="dropdown-menu-item" onclick="showProfilePage()">
                        <span style="font-weight: 600;">&#128100; Profil Saya</span>
                        <p>Lihat dan edit profil Anda</p>
                    </div>
                    
                    <div class="dropdown-menu-item" onclick="showSettingsPage()">
                        <span style="font-weight: 600;">&#9881; Pengaturan</span>
                        <p>Atur preferensi aplikasi</p>
                    </div>

                    <div class="theme-toggle-container">
                        <span style="font-weight: 600;"> Mode Gelap</span>
                        <label class="switch">
                            <input type="checkbox" id="dark-mode-toggle" checked>
                            <span class="slider"></span>
                        </label>
                    </div>
                    
                    <div class="dropdown-menu-item" onclick="logout()" style="color: #ff6b6b; font-weight: 600;">
                        <span>&#10145; Logout</span>
                    </div>
                </div>
            </div>
            </header>
        
        <div class="sidebar-left">
            <!-- PERUBAHAN: Profil sekarang horizontal -->
            <div class="user-profile">
                <img src="https://via.placeholder.com/80/927dfc/ffffff?text=U" alt="Foto Profil Pengguna" id="user-profile-pic-sidebar" class="profile-pic" onclick="showUserProfilePage()">
                <div class="profile-name-display">
                    <div class="name" id="user-profile-name-sidebar">**Nama Pengguna Anda**</div>
                    <div class="status">Online</div>
                </div>
            </div>
            
            <!-- PERUBAHAN: Fitur Tambah Teman Baru - DIPERBAIKI -->
            <div class="add-friend-section">
                <div class="add-friend-btn" onclick="toggleFriendSearch()">
                    <div class="icon">+</div>
                    <span>Tambah Pertemanan</span>
                </div>
                
                <div class="search-friend-container" id="searchFriendContainer">
                    <input type="text" class="search-friend-input" id="searchFriendInput" placeholder="Cari nama atau username..." oninput="searchFriends()">
                    
                    <div class="search-results" id="searchResults">
                        <!-- Hasil pencarian akan ditampilkan di sini -->
                    </div>
                </div>

                <!-- BARU: Daftar Teman yang Sudah Ditambahkan - DIPERBAIKI -->
                <div class="friends-list" id="friendsList">
                    <div class="friends-list-title">Teman Anda</div>
                    <div id="friendsContainer">
                        <!-- Daftar teman akan ditampilkan di sini -->
                    </div>
                </div>
            </div>
        </div>
        
        <div class="main-content">
            <!-- PERUBAHAN: Judul Beranda dipindah ke main content -->
            <div class="home-title-main">#Beranda</div>
            
            <!-- BARU: Area untuk postingan yang akan ditampilkan -->
            <div id="posts-container">
                <!-- Postingan akan ditampilkan di sini -->
            </div>
        </div>
        
        <div class="sidebar-right">
            <h3>**Rekomendasi Konten**</h3>
            <div style="margin-bottom: 15px; padding: 10px; background: rgba(146, 125, 252, 0.1); border-radius: 8px;">
                <p style="font-size: 14px; font-weight: 600;">#TrenHariIni</p>
                <p style="font-size: 12px; color: #a0a0a0;">Diskusi teknologi terbaru.</p>
            </div>
            <div style="margin-bottom: 15px; padding: 10px; background: rgba(146, 125, 252, 0.1); border-radius: 8px;">
                <p style="font-size: 14px; font-weight: 600;">@PenggunaPopuler</p>
                <p style="font-size: 12px; color: #a0a0a0;">Cek profil kreatif ini!</p>
            </div>
        </div>
        
        <!-- PERUBAHAN: Navigasi Bawah - DITAMBAH ITEM PROFIL DAN PESAN -->
        <div class="bottom-nav">
            <div class="nav-item active" onclick="showHome()">
                <div class="nav-icon"></div>
                <div class="nav-label">Beranda</div>
            </div>
            <div class="nav-item" onclick="showUploadPage()">
                <div class="nav-icon"></div>
                <div class="nav-label">Buat</div>
            </div>
            <div class="nav-item" onclick="showMessagesPage()">
                <div class="nav-icon"></div>
                <div class="nav-label">Pesan</div>
            </div>
            <div class="nav-item" onclick="showUserProfilePage()">
                <div class="nav-icon"></div>
                <div class="nav-label">Profil</div>
            </div>
        </div>
        
    </div>

    <!-- PERUBAHAN: Halaman Profil -->
    <div class="profile-page" id="profile-page" style="display:none;">
        <div class="page-header">
            <button class="back-btn" onclick="showHome()"></button>
            <h1 class="page-title">Profil Saya</h1>
        </div>

        <div class="profile-display">
            <img src="https://via.placeholder.com/80/927dfc/ffffff?text=U" alt="Foto Profil" id="profile-page-pic" class="profile-pic">
            <h2 id="profile-page-name">Nama Pengguna</h2>
        </div>

        <div class="info-group">
            <div class="info-label">Email</div>
            <div class="info-value sensitive-info" id="profile-page-email">@.com</div>
        </div>

        <div class="info-group">
            <div class="info-label">Kata Sandi</div>
            <div class="info-value sensitive-info"></div>
        </div>

        <div class="input-group">
            <label for="edit-profile-name">Nama Profil</label>
            <input type="text" id="edit-profile-name" placeholder="Masukkan nama baru">
        </div>

        <div class="input-group">
            <button type="button" onclick="updateProfile()">Perbarui Profil</button>
        </div>

        <div class="input-group">
            <label>Ubah Foto Profil</label>
            <input type="file" id="edit-profile-pic" accept="image/*" style="display:none;">
            <button type="button" onclick="document.getElementById('edit-profile-pic').click()">Pilih Foto Baru</button>
        </div>
    </div>

    <!-- PERUBAHAN: Halaman Setting - SEMUA FITUR AKTIF -->
    <div class="settings-page" id="settings-page" style="display:none;">
        <div class="page-header">
            <button class="back-btn" onclick="showHome()"></button>
            <h1 class="page-title">Pengaturan</h1>
        </div>

        <!-- Mode Tampilan -->
        <div class="settings-option" onclick="toggleSubMenu('theme-menu')">
            <div class="option-info">
                <div class="option-title">Mode Tampilan</div>
                <div class="option-desc">Ubah antara mode gelap dan terang</div>
            </div>
            <div class="theme-toggle-container" style="border: none; padding: 0; margin: 0;">
                <span id="theme-status"> Mode Gelap</span>
                <label class="switch">
                    <input type="checkbox" id="settings-dark-mode-toggle" checked>
                    <span class="slider"></span>
                </label>
            </div>
        </div>

        <!-- Notifikasi -->
        <div class="settings-option" onclick="toggleSubMenu('notification-menu')">
            <div class="option-info">
                <div class="option-title">Notifikasi</div>
                <div class="option-desc">Kelola pemberitahuan aplikasi</div>
            </div>
            <span></span>
        </div>

        <div class="sub-menu" id="notification-menu">
            <div class="notification-option">
                <div class="option-info">
                    <div class="option-title">Notifikasi Postingan</div>
                    <div class="option-desc">Dapatkan pemberitahuan postingan baru</div>
                </div>
                <label class="switch">
                    <input type="checkbox" id="post-notification" checked>
                    <span class="slider"></span>
                </label>
            </div>
            <div class="notification-option">
                <div class="option-info">
                    <div class="option-title">Notifikasi Pesan</div>
                    <div class="option-desc">Dapatkan pemberitahuan pesan baru</div>
                </div>
                <label class="switch">
                    <input type="checkbox" id="message-notification" checked>
                    <span class="slider"></span>
                </label>
            </div>
            <div class="notification-option">
                <div class="option-info">
                    <div class="option-title">Notifikasi Pertemanan</div>
                    <div class="option-desc">Dapatkan pemberitahuan permintaan teman</div>
                </div>
                <label class="switch">
                    <input type="checkbox" id="friend-notification" checked>
                    <span class="slider"></span>
                </label>
            </div>
        </div>

        <!-- Privasi -->
        <div class="settings-option" onclick="toggleSubMenu('privacy-menu')">
            <div class="option-info">
                <div class="option-title">Privasi</div>
                <div class="option-desc">Atur siapa yang dapat melihat profil Anda</div>
            </div>
            <span></span>
        </div>

        <div class="sub-menu" id="privacy-menu">
            <div class="privacy-option">
                <div class="option-info">
                    <div class="option-title">Profil Publik</div>
                    <div class="option-desc">Semua orang dapat melihat profil Anda</div>
                </div>
                <label class="switch">
                    <input type="checkbox" id="public-profile" checked>
                    <span class="slider"></span>
                </label>
            </div>
            <div class="privacy-option">
                <div class="option-info">
                    <div class="option-title">Tampilkan Status Online</div>
                    <div class="option-desc">Orang lain dapat melihat status online Anda</div>
                </div>
                <label class="switch">
                    <input type="checkbox" id="online-status" checked>
                    <span class="slider"></span>
                </label>
            </div>
            <div class="privacy-option">
                <div class="option-info">
                    <div class="option-title">Izinkan Pesan Langsung</div>
                    <div class="option-desc">Orang dapat mengirim pesan langsung</div>
                </div>
                <label class="switch">
                    <input type="checkbox" id="direct-messages" checked>
                    <span class="slider"></span>
                </label>
            </div>
        </div>

        <!-- Bahasa -->
        <div class="settings-option" onclick="toggleSubMenu('language-menu')">
            <div class="option-info">
                <div class="option-title">Bahasa</div>
                <div class="option-desc">Pilih bahasa aplikasi</div>
            </div>
            <span id="current-language">Indonesia </span>
        </div>

        <div class="sub-menu" id="language-menu">
            <select class="language-select" id="language-select" onchange="changeLanguage(this.value)">
                <option value="id">Bahasa Indonesia</option>
                <option value="en">English</option>
                <option value="es">Espaol</option>
                <option value="fr">Franais</option>
                <option value="de">Deutsch</option>
                <option value="ja"></option>
                <option value="zh"></option>
            </select>
        </div>

        <!-- Pengaturan Akun -->
        <div class="settings-option" onclick="toggleSubMenu('account-menu')">
            <div class="option-info">
                <div class="option-title">Pengaturan Akun</div>
                <div class="option-desc">Kelola data akun Anda</div>
            </div>
            <span></span>
        </div>

        <div class="sub-menu" id="account-menu">
            <div class="input-group">
                <label>Ubah Email</label>
                <input type="email" id="change-email" placeholder="Email baru">
                <button type="button" onclick="changeEmail()">Simpan Email</button>
            </div>
            <div class="input-group">
                <label>Ubah Kata Sandi</label>
                <input type="password" id="current-password" placeholder="Kata sandi saat ini">
                <input type="password" id="new-password" placeholder="Kata sandi baru">
                <button type="button" onclick="changePassword()">Simpan Kata Sandi</button>
            </div>
        </div>

        <!-- Reset Pengaturan -->
        <div class="settings-option" onclick="resetSettings()" style="color: #ff6b6b;">
            <div class="option-info">
                <div class="option-title">Reset Pengaturan</div>
                <div class="option-desc">Kembalikan semua pengaturan ke default</div>
            </div>
            <span></span>
        </div>
    </div>

    <!-- PERUBAHAN: Halaman Pesan/Notifikasi - HANYA UNTUK OPERATOR -->
    <div class="messages-page" id="messages-page" style="display:none;">
        <div class="messages-header">
            <button class="back-btn" onclick="showHome()"></button>
            <h2 class="page-title">Pesan Operator</h2>
        </div>
        
        <div class="messages-content">
            <div class="message-list" id="message-list">
                <!-- Hanya operator yang ditampilkan di sini -->
            </div>
        </div>
    </div>

    <!-- BARU: Halaman Chat dengan Teman -->
    <div class="friend-chat-page" id="friend-chat-page" style="display:none;">
        <div class="friend-chat-header">
            <button class="back-btn" onclick="showHome()"></button>
            <img src="https://via.placeholder.com/80/927dfc/ffffff?text=F" alt="Foto Teman" id="friend-chat-profile-pic" class="profile-pic">
            <div class="chat-info">
                <div class="chat-name" id="friend-chat-profile-name">Nama Teman</div>
                <div class="chat-status" id="friend-chat-status">Online</div>
            </div>
        </div>
        
        <div class="friend-chat-content" id="friend-chat-content">
            <!-- Pesan dengan teman akan ditampilkan di sini -->
        </div>
        
        <div class="friend-chat-input-container">
            <textarea class="chat-input" id="friend-chat-input" placeholder="Ketik pesan..." rows="1"></textarea>
            <button class="chat-send-btn" onclick="sendFriendMessage()"></button>
        </div>
    </div>

    <!-- BARU: Halaman Chat dengan Operator (Tetap Ada) -->
    <div class="chat-page" id="chat-page" style="display:none;">
        <div class="chat-header">
            <button class="back-btn" onclick="showMessagesPage()"></button>
            <img src="https://via.placeholder.com/80/927dfc/ffffff?text=" alt="Foto Operator" id="chat-profile-pic" class="profile-pic">
            <div class="chat-info">
                <div class="chat-name" id="chat-profile-name"> Operator XC Xavier</div>
                <div class="chat-status" id="chat-status">Online</div>
            </div>
        </div>
        
        <div class="chat-content" id="chat-content">
            <!-- Pesan akan ditampilkan di sini -->
        </div>
        
        <div class="chat-input-container">
            <textarea class="chat-input" id="chat-input" placeholder="Ketik pesan..." rows="1"></textarea>
            <button class="chat-send-btn" onclick="sendMessage()"></button>
        </div>
    </div>

    <!-- BARU: Halaman Upload Konten SEPERTI TIKTOK -->
    <div class="upload-page" id="upload-page">
        <div class="upload-header">
            <button class="back-btn" onclick="closeUploadPage()"></button>
            <h2 class="page-title">Buat Konten</h2>
            <div></div>
        </div>
        
        <!-- Mode Selector -->
        <div class="mode-selector">
            <button class="mode-btn active" id="photo-mode-btn" onclick="switchMode('photo')">FOTO</button>
            <button class="mode-btn" id="video-mode-btn" onclick="switchMode('video')">VIDIO</button>
        </div>
        
        <!-- Camera Preview -->
        <div class="camera-container">
            <video class="camera-preview" id="camera-preview" autoplay playsinline></video>
            <canvas id="photo-canvas" style="display:none;"></canvas>
            
            <!-- Recording Timer -->
            <div class="recording-timer" id="recording-timer">00:00</div>
            
            <!-- Camera Controls -->
            <div class="camera-controls">
                <div class="flip-camera-btn" onclick="flipCamera()">
                    <span></span>
                </div>
                
                <button class="shutter-btn" id="shutter-btn" onclick="captureMedia()">
                    <!-- Tombol akan berubah tergantung mode -->
                </button>
                
                <div class="gallery-btn" onclick="openGallery()" id="gallery-btn">
                    <span></span>
                </div>
            </div>
        </div>
        
        <!-- Preview After Capture -->
        <div class="capture-preview" id="capture-preview">
            <div class="preview-media-container">
                <img id="preview-image" class="preview-media" style="display:none;">
                <video id="preview-video" class="preview-media" controls style="display:none;"></video>
            </div>
            <div class="preview-controls">
                <button class="preview-btn retake-btn" onclick="retakeMedia()">Ambil Ulang</button>
                <button class="preview-btn upload-btn" onclick="proceedToUpload()">Lanjutkan</button>
            </div>
        </div>
        
        <!-- Upload Form -->
        <div class="upload-form" id="upload-form">
            <div class="form-header">
                <button class="back-btn" onclick="backToPreview()"></button>
                <h2 class="page-title">Unggah Konten</h2>
                <div></div>
            </div>
            
            <div class="form-content">
                <div class="form-preview" id="form-preview">
                    <!-- Preview media akan ditampilkan di sini -->
                </div>
                
                <textarea class="caption-input" id="caption-input" placeholder="Tambahkan keterangan..."></textarea>
                
                <div class="upload-options">
                    <div class="option-toggle">
                        <div class="option-label">
                            <div class="option-name">Tampilkan Lokasi</div>
                            <div class="option-desc">Tambahkan lokasi ke postingan Anda</div>
                        </div>
                        <label class="switch">
                            <input type="checkbox" id="location-toggle">
                            <span class="slider"></span>
                        </label>
                    </div>
                    
                    <div class="option-toggle">
                        <div class="option-label">
                            <div class="option-name">Izinkan Komentar</div>
                            <div class="option-desc">Orang lain dapat mengomentari postingan Anda</div>
                        </div>
                        <label class="switch">
                            <input type="checkbox" id="comments-toggle" checked>
                            <span class="slider"></span>
                        </label>
                    </div>
                    
                    <div class="option-toggle">
                        <div class="option-label">
                            <div class="option-name">Bagikan ke Facebook</div>
                            <div class="option-desc">Posting juga ke Facebook</div>
                        </div>
                        <label class="switch">
                            <input type="checkbox" id="facebook-toggle">
                            <span class="slider"></span>
                        </label>
                    </div>
                </div>
            </div>
            
            <div class="form-actions">
                <button class="cancel-btn" onclick="cancelUpload()">Batal</button>
                <button class="post-btn" onclick="uploadPost()">Unggah</button>
            </div>
        </div>
    </div>

    <!-- Input file tersembunyi untuk galeri -->
    <input type="file" id="gallery-input" accept="image/*,video/*" multiple style="display:none;">

    <!-- BARU: Halaman Profil Pengguna -->
    <div class="user-profile-page" id="user-profile-page" style="display:none;">
        <div class="page-header">
            <button class="back-btn" onclick="showHome()"></button>
            <h1 class="page-title">Profil</h1>
        </div>

        <div class="profile-header">
            <img src="https://via.placeholder.com/80/927dfc/ffffff?text=U" alt="Foto Profil" id="user-profile-page-pic" class="profile-pic">
            <div class="profile-info">
                <div class="profile-name" id="user-profile-page-name">Nama Pengguna</div>
                <div class="profile-username" id="user-profile-page-username">@username</div>
                
                <div class="profile-stats">
                    <div class="stat-item">
                        <div class="stat-count" id="posts-count">0</div>
                        <div class="stat-label">Postingan</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-count" id="followers-count">0</div>
                        <div class="stat-label">Pengikut</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-count" id="following-count">0</div>
                        <div class="stat-label">Mengikuti</div>
                    </div>
                </div>
                
                <div class="profile-actions" id="profile-actions">
                    <!-- Tombol akan ditampilkan berdasarkan apakah ini profil sendiri atau profil orang lain -->
                </div>
            </div>
        </div>

        <div class="profile-tabs">
            <div class="profile-tab active" onclick="switchProfileTab('posts')">Postingan</div>
            <div class="profile-tab" onclick="switchProfileTab('liked')">Disukai</div>
        </div>

        <div class="profile-posts" id="profile-posts-container">
            <!-- Postingan pengguna akan ditampilkan di sini -->
        </div>
    </div>

    <script>
        // Kunci localStorage untuk data pengguna dan settings
        const USER_STORAGE_KEY = 'social_app_user';
        const SETTINGS_STORAGE_KEY = 'social_app_settings';
        const POSTS_STORAGE_KEY = 'social_app_posts';
        const USERS_STORAGE_KEY = 'social_app_users';
        const CHATS_STORAGE_KEY = 'social_app_chats';
        const FRIENDS_STORAGE_KEY = 'social_app_friends';
        const FRIEND_CHATS_STORAGE_KEY = 'social_app_friend_chats';
        const SEARCH_HISTORY_KEY = 'social_app_search_history';
        const FRIEND_REQUESTS_KEY = 'social_app_friend_requests';
        const LIKED_POSTS_KEY = 'social_app_liked_posts';
        const DEFAULT_PROFILE_IMG = 'https://via.placeholder.com/80/927dfc/ffffff?text=U';
        const OPERATOR_IMG = 'https://via.placeholder.com/80/927dfc/ffffff?text=';
        
        // Variabel untuk sistem upload kamera
        let currentMode = 'photo'; // 'photo' atau 'video'
        let currentStream = null;
        let isFrontCamera = true;
        let isRecording = false;
        let mediaRecorder = null;
        let recordedChunks = [];
        let recordingTimer = null;
        let recordingSeconds = 0;
        let currentMedia = null; // Untuk menyimpan media yang ditangkap
        let currentMediaType = null; // 'photo' atau 'video'
        let currentMediaURL = null; // URL untuk media yang ditangkap
        
        // RESET DATA PENGUNGA YANG SUDAH ADA (untuk testing)
        // localStorage.removeItem(USER_STORAGE_KEY);
        // localStorage.removeItem(FRIENDS_STORAGE_KEY);
        // localStorage.removeItem(FRIEND_CHATS_STORAGE_KEY);
        
        // Coba muat data pengguna dari localStorage saat startup
        let currentUser = loadUserData(); 
        let uploadedFileUrl = currentUser.img || '';
        let isLightMode = false;

        // PERUBAHAN: Load settings dan posts dari localStorage
        let appSettings = loadSettings();
        let posts = loadPosts();
        let allUsers = loadAllUsers();
        let chats = loadChats();
        let friends = loadFriends();
        let friendChats = loadFriendChats();
        let searchHistory = loadSearchHistory();
        let friendRequests = loadFriendRequests();
        let likedPosts = loadLikedPosts();

        // BARU: Variabel untuk halaman profil
        let currentProfileTab = 'posts';
        let currentProfileUser = null;

        // BARU: Variabel untuk halaman chat
        let currentChatUser = {
            id: 'operator',
            name: ' Operator XC Xavier',
            email: 'operator@xcxavier.com',
            img: OPERATOR_IMG,
            status: 'Online'
        };
        let currentChatId = null;

        // BARU: Variabel untuk chat dengan teman
        let currentFriendChatUser = null;
        let currentFriendChatId = null;

        // BARU: Variabel untuk status koneksi
        let isOnline = true;

        // Fungsi untuk memuat data pengguna dari localStorage
        function loadUserData() {
            const storedData = localStorage.getItem(USER_STORAGE_KEY);
            return storedData ? JSON.parse(storedData) : {};
        }

        // Fungsi untuk menyimpan data pengguna ke localStorage
        function saveUserData(userData) {
            localStorage.setItem(USER_STORAGE_KEY, JSON.stringify(userData));
        }

        // BARU: Fungsi untuk memuat semua pengguna
        function loadAllUsers() {
            const storedUsers = localStorage.getItem(USERS_STORAGE_KEY);
            let users = storedUsers ? JSON.parse(storedUsers) : [];
            
            // Tambahkan operator jika belum ada
            const operatorExists = users.some(u => u.email === 'operator@xcxavier.com');
            if (!operatorExists) {
                users.push({
                    id: 'operator',
                    name: ' Operator XC Xavier',
                    email: 'operator@xcxavier.com',
                    img: OPERATOR_IMG,
                    isOperator: true,
                    password: 'operator123'
                });
                localStorage.setItem(USERS_STORAGE_KEY, JSON.stringify(users));
            }
            
            return users;
        }

        // BARU: Fungsi untuk menyimpan semua pengguna
        function saveAllUsers() {
            localStorage.setItem(USERS_STORAGE_KEY, JSON.stringify(allUsers));
        }

        // BARU: Fungsi untuk memuat data chat dengan operator
        function loadChats() {
            const storedChats = localStorage.getItem(CHATS_STORAGE_KEY);
            return storedChats ? JSON.parse(storedChats) : {};
        }

        // BARU: Fungsi untuk menyimpan data chat dengan operator
        function saveChats() {
            localStorage.setItem(CHATS_STORAGE_KEY, JSON.stringify(chats));
        }

        // BARU: Fungsi untuk memuat data chat dengan teman
        function loadFriendChats() {
            const storedChats = localStorage.getItem(FRIEND_CHATS_STORAGE_KEY);
            return storedChats ? JSON.parse(storedChats) : {};
        }

        // BARU: Fungsi untuk menyimpan data chat dengan teman
        function saveFriendChats() {
            localStorage.setItem(FRIEND_CHATS_STORAGE_KEY, JSON.stringify(friendChats));
        }

        // BARU: Fungsi untuk memuat postingan
        function loadPosts() {
            const storedPosts = localStorage.getItem(POSTS_STORAGE_KEY);
            return storedPosts ? JSON.parse(storedPosts) : [];
        }

        // BARU: Fungsi untuk menyimpan postingan
        function savePosts() {
            localStorage.setItem(POSTS_STORAGE_KEY, JSON.stringify(posts));
        }

        // PERUBAHAN: Fungsi untuk memuat settings
        function loadSettings() {
            const storedSettings = localStorage.getItem(SETTINGS_STORAGE_KEY);
            if (storedSettings) {
                return JSON.parse(storedSettings);
            } else {
                // Default settings
                return {
                    darkMode: true,
                    notifications: {
                        posts: true,
                        messages: true,
                        friends: true
                    },
                    privacy: {
                        publicProfile: true,
                        onlineStatus: true,
                        directMessages: true
                    },
                    language: 'id'
                };
            }
        }

        // PERUBAHAN: Fungsi untuk menyimpan settings
        function saveSettings() {
            localStorage.setItem(SETTINGS_STORAGE_KEY, JSON.stringify(appSettings));
        }

        // BARU: Fungsi untuk memuat data permintaan pertemanan
        function loadFriendRequests() {
            const storedRequests = localStorage.getItem(FRIEND_REQUESTS_KEY);
            return storedRequests ? JSON.parse(storedRequests) : {};
        }

        // BARU: Fungsi untuk memuat postingan yang disukai
        function loadLikedPosts() {
            const storedLikedPosts = localStorage.getItem(LIKED_POSTS_KEY);
            return storedLikedPosts ? JSON.parse(storedLikedPosts) : {};
        }

        // BARU: Fungsi untuk menyimpan postingan yang disukai
        function saveLikedPosts() {
            localStorage.setItem(LIKED_POSTS_KEY, JSON.stringify(likedPosts));
        }

        // BARU: Fungsi untuk memuat riwayat pencarian
        function loadSearchHistory() {
            const storedHistory = localStorage.getItem(SEARCH_HISTORY_KEY);
            return storedHistory ? JSON.parse(storedHistory) : [];
        }

        // BARU: Fungsi untuk menyimpan riwayat pencarian
        function saveSearchHistory() {
            localStorage.setItem(SEARCH_HISTORY_KEY, JSON.stringify(searchHistory));
        }

        // BARU: Fungsi untuk memuat daftar teman - DIPERBAIKI
        function loadFriends() {
            const storedFriends = localStorage.getItem(FRIENDS_STORAGE_KEY);
            let friendsList = storedFriends ? JSON.parse(storedFriends) : [];
            
            // Pastikan setiap teman memiliki properti yang diperlukan
            friendsList = friendsList.map(friend => ({
                id: friend.id || Date.now().toString(),
                name: friend.name || 'Teman',
                email: friend.email || '',
                img: friend.img || DEFAULT_PROFILE_IMG,
                online: friend.online !== undefined ? friend.online : Math.random() > 0.5,
                addedAt: friend.addedAt || new Date().toISOString()
            }));
            
            return friendsList;
        }

        // BARU: Fungsi untuk menyimpan daftar teman - DIPERBAIKI
        function saveFriends() {
            localStorage.setItem(FRIENDS_STORAGE_KEY, JSON.stringify(friends));
        }

        // BARU: Fungsi untuk menyembunyikan semua layar
        function hideAllScreens() {
            document.getElementById('welcome-screen').style.display = 'none';
            document.getElementById('auth-screen').style.display = 'none';
            document.getElementById('login-screen').style.display = 'none';
            document.getElementById('forgot-screen').style.display = 'none';
            document.getElementById('profile-setup-screen').style.display = 'none';
            document.getElementById('home-screen').style.display = 'none';
            document.getElementById('profile-page').style.display = 'none';
            document.getElementById('settings-page').style.display = 'none';
            document.getElementById('messages-page').style.display = 'none';
            document.getElementById('upload-page').style.display = 'none';
            document.getElementById('user-profile-page').style.display = 'none';
            document.getElementById('chat-page').style.display = 'none';
            document.getElementById('friend-chat-page').style.display = 'none';
            document.getElementById('error-screen').style.display = 'none';
            
            // Atur ulang centering body untuk auth screens
            document.body.style.display = 'flex';
            document.body.style.alignItems = 'center';
            document.body.style.justifyContent = 'center';
            document.body.style.padding = '0';
        }

        // BARU: Fungsi untuk menampilkan halaman awal
        function showWelcomeScreen() {
            hideAllScreens();
            document.getElementById('welcome-screen').style.display = 'block';
            
            // Reset form pendaftaran dan login
            document.getElementById('reg_email').value = '';
            document.getElementById('reg_password').value = '';
            document.getElementById('log_email').value = '';
            document.getElementById('log_password').value = '';
            document.getElementById('forgot_email').value = '';
            
            // Reset body styling
            document.body.style.display = 'flex';
            document.body.style.justifyContent = 'center';
            document.body.style.alignItems = 'center';
            document.body.style.minHeight = '100vh';
            document.body.style.padding = '20px';
        }

        // BARU: Fungsi untuk menampilkan halaman error koneksi
        function showErrorScreen() {
            hideAllScreens();
            document.getElementById('error-screen').style.display = 'block';
        }

        // BARU: Fungsi untuk memeriksa koneksi internet
        function checkConnection() {
            isOnline = navigator.onLine;
            
            if (isOnline) {
                // Jika koneksi tersedia, kembali ke halaman sebelumnya
                if (currentUser && currentUser.email) {
                    showHome();
                } else {
                    showWelcomeScreen();
                }
            } else {
                // Jika masih offline, perbarui status
                document.getElementById('connection-status').textContent = 'NON KONEKSI';
                alert('Masih tidak dapat terhubung ke internet. Periksa koneksi Anda.');
            }
        }

        // BARU: Event listener untuk perubahan status koneksi
        window.addEventListener('online', function() {
            isOnline = true;
            // Jika sedang di halaman error, sembunyikan
            if (document.getElementById('error-screen').style.display === 'block') {
                checkConnection();
            }
        });

        window.addEventListener('offline', function() {
            isOnline = false;
            // Tampilkan halaman error jika sedang di aplikasi
            if (document.getElementById('welcome-screen').style.display !== 'block' && 
                document.getElementById('auth-screen').style.display !== 'block' &&
                document.getElementById('login-screen').style.display !== 'block' &&
                document.getElementById('forgot-screen').style.display !== 'block' &&
                document.getElementById('profile-setup-screen').style.display !== 'block') {
                showErrorScreen();
            }
        });

        // Fungsi untuk menampilkan layar otentikasi tertentu
        function showRegister() { 
            if (!isOnline) {
                showErrorScreen();
                return;
            }
            hideAllScreens(); 
            document.getElementById('auth-screen').style.display = 'block'; 
        }
        
        function showLogin() { 
            if (!isOnline) {
                showErrorScreen();
                return;
            }
            hideAllScreens(); 
            document.getElementById('login-screen').style.display = 'block'; 
        }
        
        function showForgotPassword() { 
            if (!isOnline) {
                showErrorScreen();
                return;
            }
            hideAllScreens(); 
            document.getElementById('forgot-screen').style.display = 'block'; 
        }
        
        // Fungsi untuk menampilkan layar Setup Profil
        function showProfileSetup() {
            if (!isOnline) {
                showErrorScreen();
                return;
            }
             hideAllScreens();
             document.getElementById('profile-setup-screen').style.display = 'block';
             document.getElementById('upload-warning').style.display = 'none';
        }

        // PERUBAHAN: Fungsi untuk menampilkan halaman profil
        function showProfilePage() {
            if (!isOnline) {
                showErrorScreen();
                return;
            }
            hideAllScreens();
            document.getElementById('profile-page').style.display = 'block';
            
            // Update data di halaman profil
            document.getElementById('profile-page-name').textContent = currentUser.name;
            document.getElementById('profile-page-pic').src = currentUser.img;
            document.getElementById('edit-profile-name').value = currentUser.name;
            
            // Sensor email untuk keamanan
            if (currentUser.email) {
                const emailParts = currentUser.email.split('@');
                const username = emailParts[0].substring(0, 2) + '' + emailParts[0].substring(emailParts[0].length - 2);
                const domain = '.com';
                document.getElementById('profile-page-email').textContent = username + '@' + domain;
            }
        }

        // PERUBAHAN: Fungsi untuk menampilkan halaman setting
        function showSettingsPage() {
            if (!isOnline) {
                showErrorScreen();
                return;
            }
            hideAllScreens();
            document.getElementById('settings-page').style.display = 'block';
            
            // Update semua toggle di settings
            updateSettingsUI();
        }

        // BARU: Fungsi untuk menampilkan halaman pesan/notifikasi - HANYA UNTUK OPERATOR
        function showMessagesPage() {
            if (!isOnline) {
                showErrorScreen();
                return;
            }
            hideAllScreens();
            document.getElementById('messages-page').style.display = 'flex';
            
            // Update navigasi bawah
            updateBottomNav('messages');
            
            // Tampilkan daftar pesan HANYA dari operator
            displayOperatorMessages();
        }

        // BARU: Fungsi untuk menampilkan daftar pesan HANYA dari operator
        function displayOperatorMessages() {
            const messageList = document.getElementById('message-list');
            
            // Generate chat ID untuk operator
            const operatorChatId = [currentUser.email, 'operator@xcxavier.com'].sort().join('_');
            
            // Dapatkan chat dengan operator
            const operatorChat = chats[operatorChatId];
            
            let messagesHTML = '';
            
            // Tambahkan pesan dari operator
            if (operatorChat && operatorChat.messages.length > 0) {
                const lastMessage = operatorChat.messages[operatorChat.messages.length - 1];
                const unreadCount = operatorChat.messages.filter(m => !m.read && m.sender !== currentUser.email).length;
                
                messagesHTML += `
                    <div class="message-item ${unreadCount > 0 ? 'unread' : ''}" onclick="openOperatorChat()">
                        <img src="${OPERATOR_IMG}" alt="Operator" class="message-avatar">
                        <div class="message-info">
                            <div class="message-sender"> Operator XC Xavier</div>
                            <div class="message-preview">${lastMessage.text || '[Media]'}</div>
                            <div class="message-time">${formatTime(lastMessage.timestamp)}</div>
                        </div>
                        ${unreadCount > 0 ? `<div class="message-badge">${unreadCount}</div>` : ''}
                    </div>
                `;
            } else {
                // Jika belum ada chat dengan operator, buat pesan default
                messagesHTML += `
                    <div class="message-item unread" onclick="openOperatorChat()">
                        <img src="${OPERATOR_IMG}" alt="Operator" class="message-avatar">
                        <div class="message-info">
                            <div class="message-sender"> Operator XC Xavier</div>
                            <div class="message-preview">Selamat datang di XC Xavier! Klik untuk memulai percakapan.</div>
                            <div class="message-time">Baru</div>
                        </div>
                        <div class="message-badge">1</div>
                    </div>
                `;
                
                // Buat chat dengan operator jika belum ada
                if (!chats[operatorChatId]) {
                    chats[operatorChatId] = {
                        participants: [currentUser.email, 'operator@xcxavier.com'],
                        messages: [{
                            id: Date.now(),
                            sender: 'operator@xcxavier.com',
                            text: 'Selamat Datang Di XC Xavier Chatting! \n\nHalo! Saya Operator XC Xavier. Senang bertemu dengan Anda!',
                            timestamp: new Date().toISOString(),
                            read: false
                        }]
                    };
                    saveChats();
                }
            }
            
            messageList.innerHTML = messagesHTML;
        }

        // BARU: Fungsi untuk memformat waktu
        function formatTime(timestamp) {
            const date = new Date(timestamp);
            const now = new Date();
            const diffMs = now - date;
            const diffMins = Math.floor(diffMs / 60000);
            const diffHours = Math.floor(diffMs / 3600000);
            const diffDays = Math.floor(diffMs / 86400000);
            
            if (diffMins < 1) {
                return 'Baru saja';
            } else if (diffMins < 60) {
                return `${diffMins} menit lalu`;
            } else if (diffHours < 24) {
                return `${diffHours} jam lalu`;
            } else if (diffDays === 1) {
                return 'Kemarin';
            } else {
                return `${diffDays} hari lalu`;
            }
        }

        // BARU: Fungsi untuk membuka chat dengan operator
        function openOperatorChat() {
            if (!isOnline) {
                showErrorScreen();
                return;
            }
            hideAllScreens();
            document.getElementById('chat-page').style.display = 'flex';
            
            // Set currentChatUser ke operator
            currentChatUser = {
                id: 'operator',
                name: ' Operator XC Xavier',
                email: 'operator@xcxavier.com',
                img: OPERATOR_IMG,
                status: 'Online'
            };
            
            // Generate chat ID
            currentChatId = [currentUser.email, currentChatUser.email].sort().join('_');
            
            // Jika chat belum ada, buat chat baru
            if (!chats[currentChatId]) {
                chats[currentChatId] = {
                    participants: [currentUser.email, currentChatUser.email],
                    messages: [{
                        id: Date.now(),
                        sender: 'operator@xcxavier.com',
                        text: 'Selamat Datang Di XC Xavier Chatting! \n\nHalo! Saya Operator XC Xavier. Senang bertemu dengan Anda!',
                        timestamp: new Date().toISOString(),
                        read: false
                    }]
                };
                saveChats();
            }
            
            // Update header chat
            document.getElementById('chat-profile-name').textContent = currentChatUser.name;
            document.getElementById('chat-profile-pic').src = currentChatUser.img;
            document.getElementById('chat-status').textContent = currentChatUser.status;
            
            // Tandai pesan sebagai dibaca
            markMessagesAsRead();
            
            // Tampilkan pesan
            displayChatMessages();
            
            // Fokus ke input chat
            document.getElementById('chat-input').focus();
        }

        // BARU: Fungsi untuk membuka chat dengan teman
        function openFriendChat(friendEmail) {
            if (!isOnline) {
                showErrorScreen();
                return;
            }
            hideAllScreens();
            document.getElementById('friend-chat-page').style.display = 'flex';
            
            // Cari data teman
            const friend = friends.find(f => f.email === friendEmail);
            if (!friend) {
                alert('Teman tidak ditemukan!');
                showHome();
                return;
            }
            
            currentFriendChatUser = friend;
            
            // Generate chat ID
            currentFriendChatId = [currentUser.email, currentFriendChatUser.email].sort().join('_');
            
            // Jika chat belum ada, buat chat baru
            if (!friendChats[currentFriendChatId]) {
                friendChats[currentFriendChatId] = {
                    participants: [currentUser.email, currentFriendChatUser.email],
                    messages: []
                };
                saveFriendChats();
            }
            
            // Update header chat
            document.getElementById('friend-chat-profile-name').textContent = currentFriendChatUser.name;
            document.getElementById('friend-chat-profile-pic').src = currentFriendChatUser.img || DEFAULT_PROFILE_IMG;
            document.getElementById('friend-chat-status').textContent = currentFriendChatUser.online ? 'Online' : 'Offline';
            
            // Tampilkan pesan
            displayFriendChatMessages();
            
            // Fokus ke input chat
            document.getElementById('friend-chat-input').focus();
        }

        // BARU: Fungsi untuk menampilkan pesan di chat dengan teman
        function displayFriendChatMessages() {
            const chatContent = document.getElementById('friend-chat-content');
            const chatData = friendChats[currentFriendChatId];
            
            if (!chatData || chatData.messages.length === 0) {
                chatContent.innerHTML = '<p style="text-align: center; color: #a0a0a0; margin-top: 20px;">Belum ada pesan. Mulai percakapan!</p>';
                return;
            }
            
            let messagesHTML = '';
            
            chatData.messages.forEach(message => {
                const isSent = message.sender === currentUser.email;
                const messageTime = new Date(message.timestamp).toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' });
                
                messagesHTML += `
                    <div class="friend-message ${isSent ? 'sent' : 'received'}">
                        <div>${message.text || ''}</div>
                        <div class="friend-message-time">${messageTime}</div>
                    </div>
                `;
            });
            
            chatContent.innerHTML = messagesHTML;
            
            // Scroll ke bawah
            chatContent.scrollTop = chatContent.scrollHeight;
        }

        // BARU: Fungsi untuk mengirim pesan ke teman
        function sendFriendMessage() {
            const chatInput = document.getElementById('friend-chat-input');
            const messageText = chatInput.value.trim();
            
            if (!messageText) return;
            
            // Tambahkan pesan ke chat
            const newMessage = {
                id: Date.now(),
                sender: currentUser.email,
                text: messageText,
                timestamp: new Date().toISOString(),
                read: true
            };
            
            friendChats[currentFriendChatId].messages.push(newMessage);
            saveFriendChats();
            
            // Reset input
            chatInput.value = '';
            
            // Tampilkan pesan baru
            displayFriendChatMessages();
        }

        // BARU: Fungsi untuk menandai pesan sebagai dibaca
        function markMessagesAsRead() {
            if (!chats[currentChatId]) return;
            
            chats[currentChatId].messages.forEach(message => {
                if (message.sender !== currentUser.email) {
                    message.read = true;
                }
            });
            
            saveChats();
        }

        // BARU: Fungsi untuk menampilkan pesan di chat dengan operator
        function displayChatMessages() {
            const chatContent = document.getElementById('chat-content');
            const chatData = chats[currentChatId];
            
            if (!chatData || chatData.messages.length === 0) {
                chatContent.innerHTML = '<p style="text-align: center; color: #a0a0a0; margin-top: 20px;">Belum ada pesan. Mulai percakapan!</p>';
                return;
            }
            
            let messagesHTML = '';
            
            chatData.messages.forEach(message => {
                const isSent = message.sender === currentUser.email;
                const messageTime = new Date(message.timestamp).toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' });
                
                messagesHTML += `
                    <div class="message ${isSent ? 'sent' : 'received'}">
                        <div>${message.text || ''}</div>
                        <div class="message-time">${messageTime}</div>
                    </div>
                `;
            });
            
            chatContent.innerHTML = messagesHTML;
            
            // Scroll ke bawah
            chatContent.scrollTop = chatContent.scrollHeight;
        }

        // BARU: Fungsi untuk mengirim pesan ke operator
        function sendMessage() {
            const chatInput = document.getElementById('chat-input');
            const messageText = chatInput.value.trim();
            
            if (!messageText) return;
            
            // Tambahkan pesan ke chat
            const newMessage = {
                id: Date.now(),
                sender: currentUser.email,
                text: messageText,
                timestamp: new Date().toISOString(),
                read: true
            };
            
            chats[currentChatId].messages.push(newMessage);
            saveChats();
            
            // Reset input
            chatInput.value = '';
            
            // Tampilkan pesan baru
            displayChatMessages();
            
            // Jika chat dengan operator, kirim balasan otomatis
            if (currentChatUser.email === 'operator@xcxavier.com') {
                setTimeout(() => {
                    const replies = [
                        "Terima kasih sudah menghubungi! Ada yang bisa saya bantu?",
                        "Senang mendengar dari Anda!",
                        "Pesan Anda sudah diterima. Tim kami akan segera merespon.",
                        "Terima kasih sudah menggunakan XC Xavier!",
                        "Ada pertanyaan lain? Jangan ragu untuk bertanya!"
                    ];
                    
                    const randomReply = replies[Math.floor(Math.random() * replies.length)];
                    
                    const replyMessage = {
                        id: Date.now(),
                        sender: currentChatUser.email,
                        text: randomReply,
                        timestamp: new Date().toISOString(),
                        read: false
                    };
                    
                    chats[currentChatId].messages.push(replyMessage);
                    saveChats();
                    displayChatMessages();
                }, 1000 + Math.random() * 2000);
            }
        }

        // BARU: Fungsi untuk menampilkan halaman profil pengguna
        function showUserProfilePage() {
            if (!isOnline) {
                showErrorScreen();
                return;
            }
            hideAllScreens();
            document.getElementById('user-profile-page').style.display = 'block';
            
            // Set currentProfileUser ke currentUser (profil sendiri)
            currentProfileUser = currentUser;
            
            // Update data profil
            updateProfilePage();
            
            // Update navigasi bawah
            updateBottomNav('profile');
        }

        // BARU: Fungsi untuk memperbarui halaman profil
        function updateProfilePage() {
            if (!currentProfileUser) return;
            
            document.getElementById('user-profile-page-name').textContent = currentProfileUser.name;
            document.getElementById('user-profile-page-pic').src = currentProfileUser.img || DEFAULT_PROFILE_IMG;
            document.getElementById('user-profile-page-username').textContent = '@' + (currentProfileUser.username || currentProfileUser.name.toLowerCase().replace(/\s+/g, ''));
            
            // Hitung statistik
            const userPosts = posts.filter(post => post.userId === currentProfileUser.email || post.userId === currentProfileUser.id);
            document.getElementById('posts-count').textContent = userPosts.length;
            
            // Hitung followers dan following (sementara, bisa dikembangkan)
            const userFollowers = 0; // Akan diimplementasikan nanti
            const userFollowing = 0; // Akan diimplementasikan nanti
            
            document.getElementById('followers-count').textContent = userFollowers;
            document.getElementById('following-count').textContent = userFollowing;
            
            // Update tombol berdasarkan apakah ini profil sendiri atau profil orang lain
            updateProfileActions();
            
            // Tampilkan postingan
            displayUserPosts();
        }

        // BARU: Fungsi untuk memperbarui tombol aksi di profil
        function updateProfileActions() {
            const profileActions = document.getElementById('profile-actions');
            
            // Cek apakah ini profil sendiri
            const isOwnProfile = currentProfileUser.email === currentUser.email || currentProfileUser.id === currentUser.id;
            
            if (isOwnProfile) {
                // Ini adalah profil sendiri, tampilkan tombol edit
                profileActions.innerHTML = `
                    <div class="action-button message-button" onclick="showEditProfile()">
                        Edit Profil
                    </div>
                `;
            } else {
                // Ini adalah profil orang lain, tampilkan tombol Follow dan Kirim Pesan
                profileActions.innerHTML = `
                    <div class="action-button follow-button" id="follow-button" onclick="toggleFollow()">Follow</div>
                    <div class="action-button message-button" onclick="openFriendChat('${currentProfileUser.email}')">Kirim Pesan</div>
                `;
            }
        }

        // BARU: Fungsi untuk mengganti tab di profil
        function switchProfileTab(tab) {
            currentProfileTab = tab;
            
            // Update tampilan tab
            const tabs = document.querySelectorAll('.profile-tab');
            tabs.forEach(tabElement => {
                tabElement.classList.remove('active');
            });
            
            event.target.classList.add('active');
            
            // Tampilkan konten sesuai tab
            displayUserPosts();
        }

        // BARU: Fungsi untuk menampilkan postingan di halaman profil
        function displayUserPosts() {
            const postsContainer = document.getElementById('profile-posts-container');
            let userPosts = [];
            
            if (currentProfileTab === 'posts') {
                // Tampilkan postingan user
                userPosts = posts.filter(post => 
                    post.userId === currentProfileUser.email || post.userId === currentProfileUser.id
                );
            } else if (currentProfileTab === 'liked') {
                // Tampilkan postingan yang disukai
                const likedPostIds = likedPosts[currentUser.email] || [];
                userPosts = posts.filter(post => likedPostIds.includes(post.id));
            }
            
            if (userPosts.length === 0) {
                let message = '';
                if (currentProfileTab === 'posts') {
                    message = 'Belum ada postingan';
                } else if (currentProfileTab === 'liked') {
                    message = 'Belum ada postingan yang disukai';
                }
                
                postsContainer.innerHTML = `
                    <div class="no-posts">
                        <p>${message}</p>
                        ${currentProfileUser.email === currentUser.email || currentProfileUser.id === currentUser.id ? 
                            '<button class="camera-btn" onclick="showUploadPage()" style="margin-top: 15px;">Buat Postingan Pertama</button>' : 
                            ''}
                    </div>
                `;
                return;
            }
            
            let postsHTML = '';
            
            userPosts.forEach(post => {
                if (post.type === 'photo') {
                    postsHTML += `
                        <div class="profile-post" onclick="openPost(${post.id})">
                            <img src="${post.media}" alt="Postingan gambar">
                        </div>
                    `;
                } else if (post.type === 'video') {
                    postsHTML += `
                        <div class="profile-post" onclick="openPost(${post.id})">
                            <video src="${post.media}" muted></video>
                        </div>
                    `;
                } else if (post.type === 'text') {
                    postsHTML += `
                        <div class="profile-post profile-post-text" onclick="openPost(${post.id})">
                            ${post.description || post.media.substring(0, 100) + '...'}
                        </div>
                    `;
                }
            });
            
            postsContainer.innerHTML = postsHTML;
        }

        // BARU: Fungsi untuk membuka postingan
        function openPost(postId) {
            alert('Membuka postingan dengan ID: ' + postId);
        }

        // ==============================================
        // SISTEM UPLOAD KAMERA SEPERTI TIKTOK
        // ==============================================

        // BARU: Fungsi untuk menampilkan halaman upload kamera
        function showUploadPage() {
            if (!isOnline) {
                showErrorScreen();
                return;
            }
            
            hideAllScreens();
            document.getElementById('upload-page').style.display = 'flex';
            
            // Reset ke mode foto
            switchMode('photo');
            
            // Start camera
            startCamera();
            
            // Update navigasi bawah
            updateBottomNav('upload');
        }

        // BARU: Fungsi untuk menutup halaman upload
        function closeUploadPage() {
            // Stop camera
            stopCamera();
            
            // Kembali ke home
            showHome();
        }

        // BARU: Fungsi untuk mengganti mode (foto/video)
        function switchMode(mode) {
            currentMode = mode;
            
            // Update tombol mode
            document.getElementById('photo-mode-btn').classList.toggle('active', mode === 'photo');
            document.getElementById('video-mode-btn').classList.toggle('active', mode === 'video');
            
            // Update tombol shutter
            const shutterBtn = document.getElementById('shutter-btn');
            if (mode === 'photo') {
                shutterBtn.innerHTML = '<span style="font-size: 24px;"></span>';
                shutterBtn.classList.remove('recording');
                shutterBtn.disabled = false;
            } else {
                shutterBtn.innerHTML = '<span style="font-size: 24px;"></span>';
                shutterBtn.classList.remove('recording');
                shutterBtn.disabled = false;
            }
            
            // Sembunyikan timer recording jika ada
            document.getElementById('recording-timer').style.display = 'none';
            
            // Reset recording state
            isRecording = false;
            recordedChunks = [];
            
            // Stop recording jika sedang merekam
            if (mediaRecorder && mediaRecorder.state === 'recording') {
                mediaRecorder.stop();
            }
        }

        // BARU: Fungsi untuk memulai kamera
        async function startCamera() {
            try {
                // Hentikan stream yang ada
                if (currentStream) {
                    currentStream.getTracks().forEach(track => track.stop());
                }
                
                // Dapatkan akses kamera
                const constraints = {
                    video: {
                        facingMode: isFrontCamera ? 'user' : 'environment',
                        width: { ideal: 1280 },
                        height: { ideal: 720 }
                    },
                    audio: currentMode === 'video' // Hanya minta audio untuk mode video
                };
                
                currentStream = await navigator.mediaDevices.getUserMedia(constraints);
                
                // Tampilkan preview kamera
                const preview = document.getElementById('camera-preview');
                preview.srcObject = currentStream;
                
                // Siapkan MediaRecorder untuk mode video
                if (currentMode === 'video') {
                    mediaRecorder = new MediaRecorder(currentStream);
                    
                    mediaRecorder.ondataavailable = (event) => {
                        if (event.data.size > 0) {
                            recordedChunks.push(event.data);
                        }
                    };
                    
                    mediaRecorder.onstop = () => {
                        // Buat blob dari chunks
                        const blob = new Blob(recordedChunks, { type: 'video/mp4' });
                        currentMediaURL = URL.createObjectURL(blob);
                        currentMediaType = 'video';
                        
                        // Tampilkan preview video
                        showMediaPreview();
                    };
                }
                
            } catch (error) {
                console.error('Error mengakses kamera:', error);
                alert('Tidak dapat mengakses kamera. Pastikan Anda memberikan izin akses kamera.');
                
                // Fallback: tampilkan gambar placeholder
                const preview = document.getElementById('camera-preview');
                preview.srcObject = null;
                preview.style.background = '#000';
            }
        }

        // BARU: Fungsi untuk menghentikan kamera
        function stopCamera() {
            if (currentStream) {
                currentStream.getTracks().forEach(track => track.stop());
                currentStream = null;
            }
            
            // Stop recording jika sedang merekam
            if (mediaRecorder && mediaRecorder.state === 'recording') {
                mediaRecorder.stop();
                clearInterval(recordingTimer);
            }
        }

        // BARU: Fungsi untuk membalik kamera
        function flipCamera() {
            isFrontCamera = !isFrontCamera;
            startCamera();
        }

        // BARU: Fungsi untuk mengambil foto atau merekam video
        function captureMedia() {
            if (currentMode === 'photo') {
                capturePhoto();
            } else {
                if (isRecording) {
                    stopRecording();
                } else {
                    startRecording();
                }
            }
        }

        // BARU: Fungsi untuk mengambil foto
        function capturePhoto() {
            const preview = document.getElementById('camera-preview');
            const canvas = document.getElementById('photo-canvas');
            const context = canvas.getContext('2d');
            
            // Atur ukuran canvas sesuai dengan video
            canvas.width = preview.videoWidth;
            canvas.height = preview.videoHeight;
            
            // Gambar frame video ke canvas (dibalik untuk kamera depan)
            if (isFrontCamera) {
                context.translate(canvas.width, 0);
                context.scale(-1, 1);
            }
            
            context.drawImage(preview, 0, 0, canvas.width, canvas.height);
            
            // Reset transformasi
            if (isFrontCamera) {
                context.setTransform(1, 0, 0, 1, 0, 0);
            }
            
            // Konversi canvas ke data URL
            currentMediaURL = canvas.toDataURL('image/jpeg');
            currentMediaType = 'photo';
            
            // Tampilkan preview foto
            showMediaPreview();
        }

        // BARU: Fungsi untuk mulai merekam video
        function startRecording() {
            if (!mediaRecorder) return;
            
            // Reset chunks
            recordedChunks = [];
            
            // Mulai recording
            mediaRecorder.start();
            isRecording = true;
            
            // Update tombol shutter
            const shutterBtn = document.getElementById('shutter-btn');
            shutterBtn.innerHTML = '<span style="font-size: 24px;"></span>';
            shutterBtn.classList.add('recording');
            
            // Mulai timer
            recordingSeconds = 0;
            document.getElementById('recording-timer').style.display = 'block';
            updateRecordingTimer();
            
            recordingTimer = setInterval(() => {
                recordingSeconds++;
                updateRecordingTimer();
                
                // Batasi recording maksimal 60 detik
                if (recordingSeconds >= 60) {
                    stopRecording();
                }
            }, 1000);
        }

        // BARU: Fungsi untuk menghentikan recording
        function stopRecording() {
            if (!mediaRecorder || mediaRecorder.state !== 'recording') return;
            
            // Hentikan recording
            mediaRecorder.stop();
            isRecording = false;
            
            // Hentikan timer
            clearInterval(recordingTimer);
            document.getElementById('recording-timer').style.display = 'none';
            
            // Update tombol shutter
            const shutterBtn = document.getElementById('shutter-btn');
            shutterBtn.innerHTML = '<span style="font-size: 24px;"></span>';
            shutterBtn.classList.remove('recording');
        }

        // BARU: Fungsi untuk memperbarui timer recording
        function updateRecordingTimer() {
            const minutes = Math.floor(recordingSeconds / 60).toString().padStart(2, '0');
            const seconds = (recordingSeconds % 60).toString().padStart(2, '0');
            document.getElementById('recording-timer').textContent = `${minutes}:${seconds}`;
        }

        // BARU: Fungsi untuk menampilkan preview media yang ditangkap
        function showMediaPreview() {
            // Sembunyikan camera preview
            document.querySelector('.camera-container').style.display = 'none';
            
            // Tampilkan capture preview
            const previewContainer = document.getElementById('capture-preview');
            previewContainer.style.display = 'flex';
            
            // Tampilkan media yang sesuai
            if (currentMediaType === 'photo') {
                const previewImage = document.getElementById('preview-image');
                previewImage.src = currentMediaURL;
                previewImage.style.display = 'block';
                document.getElementById('preview-video').style.display = 'none';
            } else {
                const previewVideo = document.getElementById('preview-video');
                previewVideo.src = currentMediaURL;
                previewVideo.style.display = 'block';
                document.getElementById('preview-image').style.display = 'none';
            }
        }

        // BARU: Fungsi untuk mengambil ulang media
        function retakeMedia() {
            // Sembunyikan preview
            document.getElementById('capture-preview').style.display = 'none';
            
            // Tampilkan kembali camera preview
            document.querySelector('.camera-container').style.display = 'block';
            
            // Reset media
            currentMediaURL = null;
            currentMediaType = null;
        }

        // BARU: Fungsi untuk melanjutkan ke form upload
        function proceedToUpload() {
            // Sembunyikan preview
            document.getElementById('capture-preview').style.display = 'none';
            
            // Tampilkan form upload
            const uploadForm = document.getElementById('upload-form');
            uploadForm.style.display = 'flex';
            
            // Tampilkan preview di form
            const formPreview = document.getElementById('form-preview');
            formPreview.innerHTML = '';
            
            if (currentMediaType === 'photo') {
                const img = document.createElement('img');
                img.src = currentMediaURL;
                img.style.width = '100%';
                img.style.height = '100%';
                img.style.objectFit = 'cover';
                formPreview.appendChild(img);
            } else {
                const video = document.createElement('video');
                video.src = currentMediaURL;
                video.controls = true;
                video.style.width = '100%';
                video.style.height = '100%';
                video.style.objectFit = 'cover';
                formPreview.appendChild(video);
            }
            
            // Reset caption
            document.getElementById('caption-input').value = '';
        }

        // BARU: Fungsi untuk kembali ke preview dari form
        function backToPreview() {
            // Sembunyikan form
            document.getElementById('upload-form').style.display = 'none';
            
            // Tampilkan preview
            document.getElementById('capture-preview').style.display = 'flex';
        }

        // BARU: Fungsi untuk membuka galeri
        function openGallery() {
            document.getElementById('gallery-input').click();
        }

        // BARU: Event listener untuk input galeri
        document.getElementById('gallery-input').addEventListener('change', function(e) {
            const file = e.target.files[0];
            if (!file) return;
            
            // Tentukan tipe file
            const isImage = file.type.startsWith('image/');
            const isVideo = file.type.startsWith('video/');
            
            if (!isImage && !isVideo) {
                alert('Hanya file gambar dan video yang diizinkan!');
                return;
            }
            
            // Buat URL untuk file
            currentMediaURL = URL.createObjectURL(file);
            currentMediaType = isImage ? 'photo' : 'video';
            
            // Tampilkan preview
            showMediaPreview();
            
            // Reset input
            e.target.value = '';
        });

        // BARU: Fungsi untuk membatalkan upload
        function cancelUpload() {
            // Hapus URL media jika ada
            if (currentMediaURL) {
                URL.revokeObjectURL(currentMediaURL);
                currentMediaURL = null;
                currentMediaType = null;
            }
            
            // Sembunyikan form
            document.getElementById('upload-form').style.display = 'none';
            
            // Tampilkan kamera kembali
            document.querySelector('.camera-container').style.display = 'block';
        }

        // BARU: Fungsi untuk mengunggah postingan
        function uploadPost() {
            const caption = document.getElementById('caption-input').value.trim();
            
            if (!currentMediaURL) {
                alert('Tidak ada media untuk diunggah!');
                return;
            }
            
            // Simpan data media (dalam implementasi nyata, ini akan diupload ke server)
            // Untuk demo, kita simpan sebagai data URL di localStorage
            
            // Buat objek postingan baru
            const newPost = {
                id: Date.now(),
                userId: currentUser.email,
                userName: currentUser.name,
                userAvatar: currentUser.img,
                type: currentMediaType,
                media: currentMediaURL,
                description: caption,
                timestamp: new Date().toISOString(),
                likes: 0,
                comments: [],
                views: 0,
                shares: 0,
                liked: false,
                allowComments: document.getElementById('comments-toggle').checked,
                location: document.getElementById('location-toggle').checked ? 'Lokasi' : null
            };
            
            // Tambahkan ke daftar postingan
            posts.unshift(newPost);
            savePosts();
            
            // Hapus URL media
            URL.revokeObjectURL(currentMediaURL);
            currentMediaURL = null;
            currentMediaType = null;
            
            // Stop kamera
            stopCamera();
            
            // Tampilkan beranda
            showHome();
            
            // Tampilkan pesan sukses
            alert('Postingan berhasil diunggah!');
        }

        // BARU: Fungsi untuk menampilkan postingan di beranda
        function displayPosts() {
            const postsContainer = document.getElementById('posts-container');
            
            if (posts.length === 0) {
                postsContainer.innerHTML = `
                    <div class="no-posts-message">
                        <p>Belum ada postingan. Jadilah yang pertama membuat konten!</p>
                        <button class="camera-btn" onclick="showUploadPage()" style="margin-top: 15px;">Buat Postingan</button>
                    </div>
                `;
                return;
            }
            
            let postsHTML = '';
            
            posts.forEach(post => {
                let mediaHTML = '';
                
                if (post.type === 'photo') {
                    mediaHTML = `<img src="${post.media}" alt="Postingan gambar">`;
                } else if (post.type === 'video') {
                    mediaHTML = `<video src="${post.media}" controls></video>`;
                } else if (post.type === 'text') {
                    mediaHTML = `<div class="post-text-content">${post.media}</div>`;
                }
                
                // Format waktu posting
                const postTime = new Date(post.timestamp);
                const now = new Date();
                const diffMs = now - postTime;
                const diffMins = Math.floor(diffMs / 60000);
                const diffHours = Math.floor(diffMs / 3600000);
                const diffDays = Math.floor(diffMs / 86400000);
                
                let timeAgo = '';
                if (diffMins < 1) {
                    timeAgo = 'Baru saja';
                } else if (diffMins < 60) {
                    timeAgo = `${diffMins} menit lalu`;
                } else if (diffHours < 24) {
                    timeAgo = `${diffHours} jam lalu`;
                } else {
                    timeAgo = `${diffDays} hari lalu`;
                }
                
                // Cek apakah post sudah dilike oleh user saat ini
                const userLikedPosts = likedPosts[currentUser.email] || [];
                const isLiked = userLikedPosts.includes(post.id);
                
                postsHTML += `
                    <div class="post" data-post-id="${post.id}">
                        <div class="post-header">
                            <img src="${post.userAvatar}" alt="${post.userName}" class="post-user-avatar" onclick="showOtherUserProfile('${post.userId}')">
                            <div class="post-user-info">
                                <div class="post-username" onclick="showOtherUserProfile('${post.userId}')">${post.userName}</div>
                                <div class="post-time">${timeAgo} ${post.location ? ' ' + post.location : ''}</div>
                            </div>
                        </div>
                        <div class="post-content">
                            ${post.description ? `<div class="post-text">${post.description}</div>` : ''}
                            ${mediaHTML ? `<div class="post-media" onclick="openPost(${post.id})">${mediaHTML}</div>` : ''}
                        </div>
                        <div class="post-stats">
                            <span>${post.views} x dilihat</span>
                            <span>${post.shares} x dibagikan</span>
                        </div>
                        <div class="post-actions">
                            <div class="post-action ${isLiked ? 'active' : ''}" onclick="toggleLike(${post.id})">
                                <div class="post-action-icon">${isLiked ? '' : ''}</div>
                                <div class="post-action-count">${post.likes}</div>
                            </div>
                            <div class="post-action" onclick="toggleComments(${post.id})">
                                <div class="post-action-icon"></div>
                                <div class="post-action-count">${post.comments.length}</div>
                            </div>
                            <div class="post-action" onclick="sharePost(${post.id})">
                                <div class="post-action-icon"></div>
                                <div class="post-action-count">Bagikan</div>
                            </div>
                        </div>
                        <div class="comments-section" id="comments-${post.id}" style="display:none;">
                            <div class="comment-input">
                                <input type="text" id="comment-input-${post.id}" placeholder="Tulis komentar...">
                                <button class="comment-btn" onclick="addComment(${post.id})">Kirim</button>
                            </div>
                            <div class="comments-list" id="comments-list-${post.id}">
                                ${post.comments.map(comment => `
                                    <div class="comment">
                                        <img src="${comment.userAvatar}" alt="${comment.userName}" class="comment-avatar">
                                        <div class="comment-content">
                                            <div class="comment-user">${comment.userName}</div>
                                            <div class="comment-text">${comment.text}</div>
                                        </div>
                                    </div>
                                `).join('')}
                            </div>
                        </div>
                    </div>
                `;
            });
            
            postsContainer.innerHTML = postsHTML;
        }

        // BARU: Fungsi untuk toggle like pada postingan
        function toggleLike(postId) {
            const post = posts.find(p => p.id === postId);
            if (!post) return;
            
            // Inisialisasi likedPosts untuk user saat ini jika belum ada
            if (!likedPosts[currentUser.email]) {
                likedPosts[currentUser.email] = [];
            }
            
            const userLikedPosts = likedPosts[currentUser.email];
            const isLiked = userLikedPosts.includes(postId);
            
            if (isLiked) {
                // Unlike post
                post.likes--;
                likedPosts[currentUser.email] = userLikedPosts.filter(id => id !== postId);
            } else {
                // Like post
                post.likes++;
                likedPosts[currentUser.email].push(postId);
            }
            
            savePosts();
            saveLikedPosts();
            displayPosts();
        }

        // BARU: Fungsi untuk toggle komentar
        function toggleComments(postId) {
            const commentsSection = document.getElementById(`comments-${postId}`);
            if (commentsSection.style.display === 'none') {
                commentsSection.style.display = 'block';
            } else {
                commentsSection.style.display = 'none';
            }
        }

        // BARU: Fungsi untuk menambahkan komentar
        function addComment(postId) {
            const commentInput = document.getElementById(`comment-input-${postId}`);
            const commentText = commentInput.value.trim();
            
            if (!commentText) return;
            
            const post = posts.find(p => p.id === postId);
            if (!post) return;
            
            const newComment = {
                id: Date.now(),
                userId: currentUser.email,
                userName: currentUser.name,
                userAvatar: currentUser.img,
                text: commentText,
                timestamp: new Date().toISOString(),
                likes: 0
            };
            
            post.comments.push(newComment);
            savePosts();
            
            // Reset input dan refresh tampilan
            commentInput.value = '';
            displayPosts();
            
            // Buka section komentar
            document.getElementById(`comments-${postId}`).style.display = 'block';
        }

        // BARU: Fungsi untuk membagikan postingan
        function sharePost(postId) {
            const post = posts.find(p => p.id === postId);
            if (!post) return;
            
            post.shares++;
            savePosts();
            
            // Simulasi berbagi
            alert('Postingan berhasil dibagikan!');
            
            displayPosts();
        }

        // PERUBAHAN: Fungsi untuk update UI settings
        function updateSettingsUI() {
            // Mode gelap/terang
            const settingsToggle = document.getElementById('settings-dark-mode-toggle');
            settingsToggle.checked = appSettings.darkMode;
            document.getElementById('theme-status').textContent = appSettings.darkMode ? ' Mode Gelap' : ' Mode Cerah';
            
            // Notifikasi
            document.getElementById('post-notification').checked = appSettings.notifications.posts;
            document.getElementById('message-notification').checked = appSettings.notifications.messages;
            document.getElementById('friend-notification').checked = appSettings.notifications.friends;
            
            // Privasi
            document.getElementById('public-profile').checked = appSettings.privacy.publicProfile;
            document.getElementById('online-status').checked = appSettings.privacy.onlineStatus;
            document.getElementById('direct-messages').checked = appSettings.privacy.directMessages;
            
            // Bahasa
            document.getElementById('language-select').value = appSettings.language;
            updateLanguageDisplay();
        }

        // PERUBAHAN: Fungsi untuk toggle sub-menu
        function toggleSubMenu(menuId) {
            const menu = document.getElementById(menuId);
            const allMenus = document.querySelectorAll('.sub-menu');
            
            allMenus.forEach(m => {
                if (m.id !== menuId) {
                    m.classList.remove('active');
                }
            });
            
            menu.classList.toggle('active');
        }

        // PERUBAHAN: Fungsi untuk update tampilan bahasa
        function updateLanguageDisplay() {
            const languageNames = {
                'id': 'Indonesia',
                'en': 'English',
                'es': 'Espaol',
                'fr': 'Franais',
                'de': 'Deutsch',
                'ja': '',
                'zh': ''
            };
            document.getElementById('current-language').textContent = languageNames[appSettings.language] + ' ';
        }

        // PERUBAHAN: Fungsi untuk ganti bahasa
        function changeLanguage(lang) {
            appSettings.language = lang;
            saveSettings();
            updateLanguageDisplay();
            alert(`Bahasa telah diubah ke ${document.getElementById('language-select').options[document.getElementById('language-select').selectedIndex].text}`);
        }

        // PERUBAHAN: Fungsi untuk ganti email
        function changeEmail() {
            const newEmail = document.getElementById('change-email').value;
            if (newEmail && validateEmail(newEmail)) {
                // Cek apakah email sudah digunakan oleh pengguna lain
                const existingUser = allUsers.find(user => user.email === newEmail && user.email !== currentUser.email);
                if (existingUser) {
                    alert("Email sudah digunakan oleh pengguna lain!");
                    return;
                }
                
                // Update email di semua pengguna
                const userIndex = allUsers.findIndex(u => u.email === currentUser.email);
                if (userIndex !== -1) {
                    allUsers[userIndex].email = newEmail;
                    saveAllUsers();
                }
                
                // Update email di current user
                currentUser.email = newEmail;
                saveUserData(currentUser);
                
                document.getElementById('change-email').value = '';
                alert('Email berhasil diubah!');
            } else {
                alert('Email tidak valid!');
            }
        }

        // PERUBAHAN: Fungsi untuk ganti password
        function changePassword() {
            const currentPass = document.getElementById('current-password').value;
            const newPass = document.getElementById('new-password').value;
            
            if (!currentPass || !newPass) {
                alert('Harap isi semua field!');
                return;
            }
            
            if (newPass.length < 8) {
                alert('Kata sandi baru minimal 8 karakter!');
                return;
            }
            
            // Verifikasi password lama
            if (currentUser.password === currentPass) {
                // Update password di semua pengguna
                const userIndex = allUsers.findIndex(u => u.email === currentUser.email);
                if (userIndex !== -1) {
                    allUsers[userIndex].password = newPass;
                    saveAllUsers();
                }
                
                // Update password di current user
                currentUser.password = newPass;
                saveUserData(currentUser);
                
                document.getElementById('current-password').value = '';
                document.getElementById('new-password').value = '';
                alert('Kata sandi berhasil diubah!');
            } else {
                alert('Kata sandi saat ini salah!');
            }
        }

        // PERUBAHAN: Fungsi untuk reset settings
        function resetSettings() {
            if (confirm('Apakah Anda yakin ingin mengembalikan semua pengaturan ke default?')) {
                appSettings = {
                    darkMode: true,
                    notifications: {
                        posts: true,
                        messages: true,
                        friends: true
                    },
                    privacy: {
                        publicProfile: true,
                        onlineStatus: true,
                        directMessages: true
                    },
                    language: 'id'
                };
                saveSettings();
                updateSettingsUI();
                toggleDarkMode();
                alert('Pengaturan telah direset ke default!');
            }
        }

        // PERUBAHAN: Fungsi validasi email
        function validateEmail(email) {
            const re = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
            return re.test(email);
        }

        // Fungsi: Kembali ke Edit Profil dari Home (Memuat Data Sebelumnya)
        function showEditProfile() {
            document.querySelector('.dropdown-menu').classList.remove('active');

            document.getElementById('profile_name').value = currentUser.name || '';
            
            const previewImg = document.getElementById('preview-profile-pic');
            const placeholderText = document.getElementById('placeholder-text');
            const fileInput = document.getElementById('file_upload_input');
            const uploadWarning = document.getElementById('upload-warning');

            fileInput.value = '';

            // Tampilkan foto yang sudah ada
            if (currentUser.img && currentUser.img !== DEFAULT_PROFILE_IMG) {
                previewImg.src = currentUser.img;
                previewImg.style.display = 'block';
                placeholderText.style.display = 'none';
                uploadedFileUrl = currentUser.img;
                uploadWarning.style.display = 'none';
            } else {
                previewImg.src = '';
                previewImg.style.display = 'none';
                placeholderText.style.display = 'block';
                uploadedFileUrl = '';
                uploadWarning.style.display = 'block';
            }

            showProfileSetup();
        }
        
        // Fungsi untuk menampilkan layar Beranda
        function showHome() {
            if (!isOnline) {
                showErrorScreen();
                return;
            }
            hideAllScreens();
            document.getElementById('home-screen').style.display = 'grid';
            
            // Hapus centering body agar home-container bisa memenuhi layar
            document.body.style.display = 'block';
            document.body.style.minHeight = '100vh';

            // Update nama dan gambar di Header
            document.getElementById('user-profile-name-header').textContent = currentUser.name;
            document.getElementById('user-profile-pic-header').src = currentUser.img;
            
            // Update nama dan gambar di Sidebar
            document.getElementById('user-profile-name-sidebar').textContent = currentUser.name;
            document.getElementById('user-profile-pic-sidebar').src = currentUser.img;
            
            // Update navigasi bawah
            updateBottomNav('home');
            
            // Tampilkan postingan
            displayPosts();
            
            // Tampilkan daftar teman - DIPERBAIKI
            displayFriends();
        }

        // PERUBAHAN: Fungsi untuk update navigasi bawah
        function updateBottomNav(activeItem) {
            const navItems = document.querySelectorAll('.nav-item');
            navItems.forEach(item => {
                item.classList.remove('active');
            });
            
            if (activeItem === 'home') {
                document.querySelector('.nav-item:nth-child(1)').classList.add('active');
            } else if (activeItem === 'upload') {
                document.querySelector('.nav-item:nth-child(2)').classList.add('active');
            } else if (activeItem === 'messages') {
                document.querySelector('.nav-item:nth-child(3)').classList.add('active');
            } else if (activeItem === 'profile') {
                document.querySelector('.nav-item:nth-child(4)').classList.add('active');
            }
        }

        // Fungsi untuk Logout
        function logout() {
            // Konfirmasi logout
            const confirmLogout = confirm("Apakah Anda yakin ingin logout?");
            if (!confirmLogout) return;
            
            // Buat pesan konfirmasi visual
            const logoutMessage = document.createElement('div');
            logoutMessage.style.cssText = `
                position: fixed;
                top: 50%;
                left: 50%;
                transform: translate(-50%, -50%);
                background: var(--card-color);
                padding: 30px;
                border-radius: 15px;
                box-shadow: 0 10px 30px rgba(0,0,0,0.3);
                z-index: 1000;
                text-align: center;
                border: 2px solid var(--accent-purple);
                max-width: 400px;
                width: 90%;
            `;
            
            logoutMessage.innerHTML = `
                <h3 style="color: var(--accent-purple); margin-bottom: 15px;"> Keluar dari Aplikasi</h3>
                <p style="margin-bottom: 20px;">Anda akan logout dari akun <strong>${currentUser.name || currentUser.email}</strong></p>
                <p style="margin-bottom: 20px; color: #a0a0a0; font-size: 14px;">Semua data sesi akan dihapus dan Anda perlu login kembali untuk mengakses akun.</p>
                <div style="display: flex; gap: 10px; justify-content: center;">
                    <button onclick="confirmLogoutAction()" style="padding: 10px 20px; background: var(--accent-purple); color: white; border: none; border-radius: 8px; cursor: pointer;">Ya, Logout</button>
                    <button onclick="this.parentElement.parentElement.remove();" style="padding: 10px 20px; background: rgba(146, 125, 252, 0.2); color: var(--accent-purple); border: 1px solid var(--accent-purple); border-radius: 8px; cursor: pointer;">Batal</button>
                </div>
            `;
            
            document.body.appendChild(logoutMessage);
        }

        // Fungsi untuk konfirmasi logout
        function confirmLogoutAction() {
            // Stop kamera jika sedang aktif
            stopCamera();
            
            // Reset semua data sesi
            currentUser = {};
            uploadedFileUrl = '';
            currentChatUser = null;
            currentChatId = null;
            currentFriendChatUser = null;
            currentFriendChatId = null;
            
            // Hapus URL media jika ada
            if (currentMediaURL) {
                URL.revokeObjectURL(currentMediaURL);
                currentMediaURL = null;
                currentMediaType = null;
            }
            
            // Hapus data pengguna dari localStorage (hanya data sesi, bukan data akun)
            localStorage.removeItem(USER_STORAGE_KEY);
            
            // Hapus pesan konfirmasi
            const logoutMessage = document.querySelector('div[style*="z-index: 1000"]');
            if (logoutMessage) logoutMessage.remove();
            
            // Tampilkan animasi logout
            const logoutAnimation = document.createElement('div');
            logoutAnimation.style.cssText = `
                position: fixed;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                background: var(--bg-color);
                display: flex;
                flex-direction: column;
                justify-content: center;
                align-items: center;
                z-index: 9999;
                transition: opacity 0.5s;
            `;
            
            logoutAnimation.innerHTML = `
                <div style="font-size: 60px; margin-bottom: 20px;"></div>
                <h3 style="color: var(--accent-purple); margin-bottom: 10px;">Logout Berhasil</h3>
                <p style="color: var(--text-color); opacity: 0.8;">Anda telah keluar dari aplikasi</p>
            `;
            
            document.body.appendChild(logoutAnimation);
            
            // Setelah 1.5 detik, tampilkan halaman awal
            setTimeout(() => {
                logoutAnimation.style.opacity = '0';
                setTimeout(() => {
                    logoutAnimation.remove();
                    showWelcomeScreen();
                }, 500);
            }, 1500);
        }

        // PERUBAHAN: Fungsi Toggle Mode Gelap/Cerah yang diperbarui
        function toggleDarkMode() {
            isLightMode = !appSettings.darkMode;
            appSettings.darkMode = !isLightMode;
            saveSettings();
            
            document.body.classList.toggle('light-mode', isLightMode);

            // Update status checkbox
            const toggleCheckbox = document.getElementById('dark-mode-toggle');
            const settingsToggle = document.getElementById('settings-dark-mode-toggle');
            toggleCheckbox.checked = appSettings.darkMode;
            settingsToggle.checked = appSettings.darkMode;
            
            const themeStatus = document.getElementById('theme-status');
            if (themeStatus) {
                themeStatus.textContent = appSettings.darkMode ? ' Mode Gelap' : ' Mode Cerah';
            }
        }

        // PERUBAHAN: Event listeners untuk semua toggle settings
        function setupSettingsEventListeners() {
            // Mode gelap/terang
            document.getElementById('settings-dark-mode-toggle').addEventListener('change', function() {
                appSettings.darkMode = this.checked;
                saveSettings();
                toggleDarkMode();
            });

            // Notifikasi
            document.getElementById('post-notification').addEventListener('change', function() {
                appSettings.notifications.posts = this.checked;
                saveSettings();
                alert(`Notifikasi postingan ${this.checked ? 'diaktifkan' : 'dimatikan'}`);
            });

            document.getElementById('message-notification').addEventListener('change', function() {
                appSettings.notifications.messages = this.checked;
                saveSettings();
                alert(`Notifikasi pesan ${this.checked ? 'diaktifkan' : 'dimatikan'}`);
            });

            document.getElementById('friend-notification').addEventListener('change', function() {
                appSettings.notifications.friends = this.checked;
                saveSettings();
                alert(`Notifikasi pertemanan ${this.checked ? 'diaktifkan' : 'dimatikan'}`);
            });

            // Privasi
            document.getElementById('public-profile').addEventListener('change', function() {
                appSettings.privacy.publicProfile = this.checked;
                saveSettings();
                alert(`Profil ${this.checked ? 'publik' : 'pribadi'}`);
            });

            document.getElementById('online-status').addEventListener('change', function() {
                appSettings.privacy.onlineStatus = this.checked;
                saveSettings();
                alert(`Status online ${this.checked ? 'ditampilkan' : 'disembunyikan'}`);
            });

            document.getElementById('direct-messages').addEventListener('change', function() {
                appSettings.privacy.directMessages = this.checked;
                saveSettings();
                alert(`Pesan langsung ${this.checked ? 'diizinkan' : 'diblokir'}`);
            });
        }

        // PERUBAHAN: Fungsi untuk update profil
        function updateProfile() {
            const newName = document.getElementById('edit-profile-name').value;
            
            if (newName.trim() === '') {
                alert("Nama profil tidak boleh kosong!");
                return;
            }
            
            currentUser.name = newName;
            saveUserData(currentUser);
            
            // Update di semua pengguna juga
            const userIndex = allUsers.findIndex(u => u.email === currentUser.email);
            if (userIndex !== -1) {
                allUsers[userIndex].name = newName;
                saveAllUsers();
            }
            
            alert("Profil berhasil diperbarui!");
            showProfilePage();
        }

        // PERUBAHAN: Fungsi untuk toggle fitur pencarian teman - DIPERBAIKI
        function toggleFriendSearch() {
            const searchContainer = document.getElementById('searchFriendContainer');
            const searchInput = document.getElementById('searchFriendInput');
            
            if (searchContainer.style.display === 'block') {
                searchContainer.style.display = 'none';
                searchInput.value = '';
                document.getElementById('searchResults').innerHTML = '';
            } else {
                searchContainer.style.display = 'block';
                searchInput.focus();
                
                // Tampilkan pesan untuk memasukkan pencarian
                document.getElementById('searchResults').innerHTML = '<p style="text-align: center; color: #a0a0a0; font-size: 14px; padding: 10px;">Masukkan nama atau email untuk mencari teman</p>';
            }
        }

        // PERUBAHAN: Fungsi untuk mencari teman - DIPERBAIKI
        function searchFriends() {
            const searchTerm = document.getElementById('searchFriendInput').value.toLowerCase();
            const searchResults = document.getElementById('searchResults');
            
            if (searchTerm.length === 0) {
                // Jika pencarian kosong, tidak tampilkan apa-apa
                searchResults.innerHTML = '<p style="text-align: center; color: #a0a0a0; font-size: 14px; padding: 10px;">Masukkan nama atau email untuk mencari teman</p>';
                return;
            }
            
            // Cari dari database pengguna yang sebenarnya (allUsers)
            const filteredUsers = allUsers.filter(user => 
                (user.email !== currentUser.email) && // Bukan diri sendiri
                !user.isOperator && // Bukan operator
                (user.name && user.name.toLowerCase().includes(searchTerm) || 
                 user.email && user.email.toLowerCase().includes(searchTerm))
            );
            
            if (filteredUsers.length === 0) {
                searchResults.innerHTML = '<p style="text-align: center; color: #a0a0a0; font-size: 14px; padding: 10px;">Tidak ada hasil ditemukan</p>';
                return;
            }
            
            let resultsHTML = '';
            filteredUsers.forEach(user => {
                // Cek apakah user sudah menjadi teman
                const isAlreadyFriend = friends.some(friend => 
                    friend.email === user.email
                );
                
                resultsHTML += `
                    <div class="friend-result-item">
                        <div class="friend-info">
                            <img src="${user.img || DEFAULT_PROFILE_IMG}" alt="${user.name}" class="friend-avatar">
                            <div class="friend-details">
                                <div class="friend-name">${user.name || user.email}</div>
                                <div class="friend-username">${user.email}</div>
                            </div>
                        </div>
                        <div class="add-friend-icon" onclick="addFriend('${user.email}')" style="${isAlreadyFriend ? 'background: #4CAF50;' : ''}">
                            ${isAlreadyFriend ? '' : '+'}
                        </div>
                    </div>
                `;
            });
            
            searchResults.innerHTML = resultsHTML;
        }

        // PERUBAHAN: Fungsi untuk menambahkan teman - DIPERBAIKI
        function addFriend(userEmail) {
            // Cari data pengguna dari database
            const userToAdd = allUsers.find(user => user.email === userEmail);
            
            if (!userToAdd) {
                alert('Pengguna tidak ditemukan!');
                return;
            }
            
            // Cek apakah userEmail adalah diri sendiri
            if (userEmail === currentUser.email) {
                alert('Tidak bisa menambahkan diri sendiri!');
                return;
            }
            
            // Cek apakah sudah menjadi teman
            const isAlreadyFriend = friends.some(friend => friend.email === userEmail);
            
            if (isAlreadyFriend) {
                alert(`${userToAdd.name || userToAdd.email} sudah menjadi teman Anda!`);
                return;
            }
            
            // Tambahkan ke daftar teman
            friends.push({
                id: userToAdd.id || Date.now().toString(),
                name: userToAdd.name || userToAdd.email,
                email: userToAdd.email,
                img: userToAdd.img || DEFAULT_PROFILE_IMG,
                online: Math.random() > 0.5,
                addedAt: new Date().toISOString()
            });
            
            saveFriends();
            
            // Refresh tampilan pencarian
            searchFriends();
            
            // Refresh daftar teman
            displayFriends();
            
            alert(`${userToAdd.name || userToAdd.email} telah ditambahkan sebagai teman!`);
            
            // Buat chat dengan teman baru
            const friendChatId = [currentUser.email, userEmail].sort().join('_');
            if (!friendChats[friendChatId]) {
                friendChats[friendChatId] = {
                    participants: [currentUser.email, userEmail],
                    messages: [{
                        id: Date.now(),
                        sender: userEmail,
                        text: `Halo! Saya ${userToAdd.name || userToAdd.email}. Senang bertemu dengan Anda!`,
                        timestamp: new Date().toISOString(),
                        read: false
                    }]
                };
                saveFriendChats();
            }
        }

        // BARU: Fungsi untuk menampilkan daftar teman - DIPERBAIKI
        function displayFriends() {
            const friendsContainer = document.getElementById('friendsContainer');
            
            if (friends.length === 0) {
                friendsContainer.innerHTML = '<p style="text-align: center; color: #a0a0a0; font-size: 14px; padding: 10px;">Belum ada teman. Cari dan tambahkan teman!</p>';
                return;
            }
            
            let friendsHTML = '';
            
            friends.forEach(friend => {
                friendsHTML += `
                    <div class="friend-item" onclick="openFriendChat('${friend.email}')">
                        <img src="${friend.img || DEFAULT_PROFILE_IMG}" alt="${friend.name}" class="friend-avatar">
                        <div class="friend-details">
                            <div class="friend-name">${friend.name}</div>
                            <div class="friend-status">
                                <span class="status-indicator ${friend.online ? 'status-online' : 'status-offline'}"></span>
                                ${friend.online ? 'Online' : 'Offline'}
                            </div>
                        </div>
                    </div>
                `;
            });
            
            friendsContainer.innerHTML = friendsHTML;
        }

        // BARU: Fungsi untuk menampilkan profil pengguna lain
        function showOtherUserProfile(userId) {
            // Cari user berdasarkan ID
            const user = allUsers.find(u => u.id === userId || u.email === userId);
            if (!user) return;
            
            hideAllScreens();
            document.getElementById('user-profile-page').style.display = 'block';
            
            currentProfileUser = user;
            updateProfilePage();
            updateBottomNav('profile');
        }

        // 1. Proses Pendaftaran -> Lanjut ke Setup Profil
        document.getElementById('register-form').addEventListener('submit', function(e) {
            e.preventDefault();
            const email = document.getElementById('reg_email').value;
            const password = document.getElementById('reg_password').value;
            
            // Validasi email
            if (!validateEmail(email)) {
                alert("Format email tidak valid!");
                return;
            }
            
            // Validasi password
            if (password.length < 8) {
                alert("Kata sandi minimal 8 karakter!");
                return;
            }
            
            // Cek apakah email sudah terdaftar
            const existingUser = allUsers.find(user => user.email === email);
            if (existingUser) {
                // Tampilkan pesan dengan logika yang lebih baik
                const messageBox = document.createElement('div');
                messageBox.style.cssText = `
                    position: fixed;
                    top: 50%;
                    left: 50%;
                    transform: translate(-50%, -50%);
                    background: var(--card-color);
                    padding: 30px;
                    border-radius: 15px;
                    box-shadow: 0 10px 30px rgba(0,0,0,0.3);
                    z-index: 1000;
                    text-align: center;
                    border: 2px solid var(--accent-purple);
                    max-width: 400px;
                    width: 90%;
                `;
                
                messageBox.innerHTML = `
                    <h3 style="color: var(--accent-purple); margin-bottom: 15px;"> Email Sudah Terdaftar</h3>
                    <p style="margin-bottom: 20px;">Email <strong>${email}</strong> sudah terdaftar di sistem.</p>
                    <p style="margin-bottom: 20px; color: #a0a0a0; font-size: 14px;">Silakan login jika ini adalah akun Anda, atau gunakan email lain untuk mendaftar.</p>
                    <div style="display: flex; gap: 10px; justify-content: center;">
                        <button onclick="this.parentElement.parentElement.remove(); showLogin();" style="padding: 10px 20px; background: var(--accent-purple); color: white; border: none; border-radius: 8px; cursor: pointer;">Login Sekarang</button>
                        <button onclick="this.parentElement.parentElement.remove();" style="padding: 10px 20px; background: rgba(146, 125, 252, 0.2); color: var(--accent-purple); border: 1px solid var(--accent-purple); border-radius: 8px; cursor: pointer;">Gunakan Email Lain</button>
                    </div>
                `;
                
                document.body.appendChild(messageBox);
                return;
            }
            
            // Data sementara untuk register
            currentUser.email = email;
            currentUser.password = password; // Hanya untuk simulasi
            
            // Reset data profil untuk pendaftaran baru
            uploadedFileUrl = '';
            currentUser.name = '';
            currentUser.img = DEFAULT_PROFILE_IMG;

            // Simpan user baru ke daftar semua pengguna
            allUsers.push({
                id: Date.now().toString(),
                email: currentUser.email,
                password: currentUser.password,
                name: '',
                img: DEFAULT_PROFILE_IMG
            });
            saveAllUsers();
            
            saveUserData(currentUser); // Simpan data awal
            
            alert(" Pendaftaran Berhasil! Sekarang lengkapi profil Anda.");
            showEditProfile();
        });
        
        // 2. Proses Login -> Lanjut ke Setup Profil/Beranda
        document.getElementById('login-form').addEventListener('submit', function(e) {
            e.preventDefault();
            const loginEmail = document.getElementById('log_email').value;
            const loginPassword = document.getElementById('log_password').value;

            // Cari user di daftar semua pengguna
            const user = allUsers.find(u => u.email === loginEmail && u.password === loginPassword);
            
            if (user) {
                currentUser = user;
                saveUserData(currentUser); // Simpan sebagai user aktif
                uploadedFileUrl = currentUser.img;
                alert("Login Berhasil!");

                // Jika nama dan gambar sudah lengkap, langsung ke Beranda
                if (currentUser.name && currentUser.img && currentUser.img !== DEFAULT_PROFILE_IMG) {
                    showHome();
                } else {
                    // Jika profil belum lengkap, arahkan ke setup profil
                    showEditProfile();
                }
            } else {
                alert("Login Gagal! Email atau kata sandi salah.");
            }
        });
        
        // 3. Proses Lupa Password
        document.getElementById('forgot-form').addEventListener('submit', function(e) {
            e.preventDefault();
            const email = document.getElementById('forgot_email').value;
            
            // Validasi email
            if (!validateEmail(email)) {
                alert("Format email tidak valid!");
                return;
            }
            
            // Cek apakah email terdaftar
            const userExists = allUsers.find(user => user.email === email);
            if (!userExists) {
                alert("Email tidak terdaftar dalam sistem!");
                return;
            }
            
            alert("Tautan reset password telah dikirim ke email Anda (simulasi).");
        });
        
        // 4. Handle File Upload dan Preview dari Galeri
        document.getElementById('file_upload_input').addEventListener('change', function(e) {
            const file = e.target.files[0];
            const previewImg = document.getElementById('preview-profile-pic');
            const placeholderText = document.getElementById('placeholder-text');
            const uploadWarning = document.getElementById('upload-warning');
            
            if (file) {
                const reader = new FileReader();
                
                reader.onload = function(event) {
                    previewImg.src = event.target.result;
                    previewImg.style.display = 'block';
                    placeholderText.style.display = 'none';
                    uploadWarning.style.display = 'none';

                    uploadedFileUrl = event.target.result;
                };
                
                reader.readAsDataURL(file);
            } else {
                if (uploadedFileUrl) {
                    previewImg.src = uploadedFileUrl;
                    previewImg.style.display = 'block';
                    placeholderText.style.display = 'none';
                    uploadWarning.style.display = 'none';
                } else {
                    previewImg.src = '';
                    previewImg.style.display = 'none';
                    placeholderText.style.display = 'block';
                    uploadWarning.style.display = 'block';
                }
            }
        });

        // PERUBAHAN: Handle upload foto profil di halaman profil
        document.getElementById('edit-profile-pic').addEventListener('change', function(e) {
            const file = e.target.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = function(event) {
                    currentUser.img = event.target.result;
                    // Update di semua pengguna juga
                    const userIndex = allUsers.findIndex(u => u.email === currentUser.email);
                    if (userIndex !== -1) {
                        allUsers[userIndex].img = event.target.result;
                        saveAllUsers();
                    }
                    saveUserData(currentUser);
                    document.getElementById('profile-page-pic').src = event.target.result;
                    alert("Foto profil berhasil diubah!");
                };
                reader.readAsDataURL(file);
            }
        });

        // 5. Proses Setup Profil -> Lanjut ke Beranda (DENGAN VALIDASI FOTO WAJIB)
        document.getElementById('profile-setup-form').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const profileName = document.getElementById('profile_name').value;
            const uploadWarning = document.getElementById('upload-warning');

            // **VALIDASI WAJIB FOTO PROFIL**
            if (!uploadedFileUrl || profileName.trim() === '') {
                uploadWarning.style.display = 'block';
                alert("Mohon lengkapi **Nama Profil** dan **Unggah Foto Profil** sebelum melanjutkan.");
                return;
            }
            
            // Simpan data profil ke objek currentUser dan localStorage
            currentUser.name = profileName;
            currentUser.img = uploadedFileUrl;
            
            // Update di semua pengguna juga
            const userIndex = allUsers.findIndex(u => u.email === currentUser.email);
            if (userIndex !== -1) {
                allUsers[userIndex].name = profileName;
                allUsers[userIndex].img = uploadedFileUrl;
                saveAllUsers();
            }
            
            saveUserData(currentUser);

            // Buat chat dengan operator untuk user baru
            const operatorChatId = [currentUser.email, 'operator@xcxavier.com'].sort().join('_');
            if (!chats[operatorChatId]) {
                chats[operatorChatId] = {
                    participants: [currentUser.email, 'operator@xcxavier.com'],
                    messages: [{
                        id: Date.now(),
                        sender: 'operator@xcxavier.com',
                        text: 'Selamat Datang Di XC Xavier Chatting! \n\nHalo! Saya Operator XC Xavier. Senang bertemu dengan Anda!',
                        timestamp: new Date().toISOString(),
                        read: false
                    }]
                };
                saveChats();
            }

            alert(`Profil ${profileName} telah disimpan/diperbarui. Selamat datang!`);
            showHome();
        });
        
        // 6. Event Listener untuk Toggle Dark Mode
        document.getElementById('dark-mode-toggle').addEventListener('change', toggleDarkMode);

        // PERUBAHAN: Event listener untuk pencarian teman
        document.getElementById('searchFriendInput').addEventListener('input', searchFriends);

        // 7. Penanganan saat Halaman Dimuat
        function initApp() {
            // Cek status koneksi
            isOnline = navigator.onLine;
            
            // Cek apakah ada user yang sudah login
            const storedUser = loadUserData();
            if (storedUser && storedUser.email) {
                // Cari user di daftar semua pengguna
                const user = allUsers.find(u => u.email === storedUser.email);
                if (user) {
                    currentUser = user;
                    
                    // Jika ada data di localStorage, cek kelengkapan profil
                    if (currentUser.name && currentUser.img && currentUser.img !== DEFAULT_PROFILE_IMG) {
                        showHome(); // Langsung ke Beranda
                    } else {
                        showEditProfile(); // Lanjutkan setup profil
                    }
                } else {
                    // Jika user tidak ditemukan di database, hapus data sesi
                    localStorage.removeItem(USER_STORAGE_KEY);
                    showWelcomeScreen(); // User tidak ditemukan, arahkan ke halaman awal
                }
            } else {
                // Jika tidak ada halaman, tampilkan halaman awal
                showWelcomeScreen();
            }

            // PERUBAHAN: Setup event listeners untuk settings
            setupSettingsEventListeners();
            
            // PERUBAHAN: Terapkan settings saat startup
            document.body.classList.toggle('light-mode', !appSettings.darkMode);
        }

        // Jalankan inisialisasi aplikasi
        initApp();

    </script>
</body>
</html>
